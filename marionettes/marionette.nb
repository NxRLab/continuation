(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[    101198,       2156]
NotebookOptionsPosition[    100127,       2121]
NotebookOutlinePosition[    100469,       2136]
CellTagsIndexPosition[    100426,       2133]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetDirectory", "[", "\"\<../\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{"NDSolve", ",", " ", 
    RowBox[{"AccuracyGoal", "\[Rule]", " ", "13"}], ",", " ", 
    RowBox[{"PrecisionGoal", "\[Rule]", " ", "13"}], ",", " ", 
    "\[IndentingNewLine]", 
    RowBox[{"Compiled", "\[Rule]", " ", "False"}], ",", " ", 
    RowBox[{"MaxSteps", "\[Rule]", " ", "Infinity"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"<<", "\"\<NLink`\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.602095934984855*^9, 3.602095940641183*^9}, {
  3.6020959794324055`*^9, 3.6020960452321663`*^9}, {3.6020960916088247`*^9, 
  3.6020961631929235`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"n", " ", "=", " ", "2"}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"#", " ", "of", " ", "bodies"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"L", " ", "=", " ", "1"}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"link", " ", "length"}], " ", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"R", " ", "=", " ", 
    RowBox[{"1", "/", "2"}]}], ";", " ", 
   RowBox[{"(*", " ", 
    RowBox[{"wheel", " ", "radius"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"M", " ", "=", " ", "1"}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"wheel", " ", "mass"}], " ", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"r", " ", "=", " ", 
    RowBox[{"1", "/", "2"}]}], ";", " ", 
   RowBox[{"(*", " ", 
    RowBox[{"winch", " ", "radius"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"m", " ", "=", " ", 
    RowBox[{"1", "/", "2"}]}], ";", " ", 
   RowBox[{"(*", " ", 
    RowBox[{"winch", " ", "mass"}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"dimensionless", " ", "units"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"\[Alpha]", " ", "=", " ", 
    RowBox[{"1", "/", "2"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"c", ".", "o", ".", "m"}], " ", 
    RowBox[{"position", " ", "/", " ", "link"}], " ", "length"}], " ", 
   "*)"}]}]}], "Input",
 CellChangeTimes->{{3.5938593516290765`*^9, 3.593859371822229*^9}, 
   3.593859457086112*^9, {3.593859531702386*^9, 3.5938595484463434`*^9}, 
   3.593859728422651*^9, {3.5938599208146677`*^9, 3.5938600193503103`*^9}, {
   3.593860441262472*^9, 3.593860506702219*^9}, {3.5938606833833375`*^9, 
   3.593860729126957*^9}, {3.5938607597357063`*^9, 3.593860855151174*^9}, {
   3.593860890943224*^9, 3.5938608959115086`*^9}, {3.593860965991522*^9, 
   3.5938610380946503`*^9}, {3.593861209230451*^9, 3.593861312447359*^9}, {
   3.5938613586320066`*^9, 3.5938615062434607`*^9}, {3.59386153854531*^9, 
   3.5938615886171727`*^9}, {3.5938620697057247`*^9, 
   3.5938620827614727`*^9}, {3.593862223302523*^9, 3.593862231727001*^9}, {
   3.5938623058712516`*^9, 3.593862411442295*^9}, {3.593862496147148*^9, 
   3.5938625714754624`*^9}, {3.5938626031912737`*^9, 3.593862729051483*^9}, {
   3.5938628170415287`*^9, 3.5938628174255466`*^9}, {3.5938631780081964`*^9, 
   3.5938631933590727`*^9}, {3.5938638804314203`*^9, 3.59386391689251*^9}, {
   3.5938640387894955`*^9, 3.5938640517492275`*^9}, {3.593864261357236*^9, 
   3.5938642779491863`*^9}, 3.5938644271517277`*^9, {3.593864463104785*^9, 
   3.5938645691868773`*^9}, {3.5938646105112305`*^9, 
   3.5938646337825584`*^9}, {3.5938647824240713`*^9, 3.593864808646573*^9}, {
   3.593864951623762*^9, 3.59386497262398*^9}, {3.5938652083664675`*^9, 
   3.593865267975879*^9}, 3.5938810583071356`*^9, 3.5938816884852223`*^9, {
   3.5938817434183683`*^9, 3.593881779394436*^9}, 3.5938900852510786`*^9, {
   3.593890177261346*^9, 3.5938902009737043`*^9}, {3.593890371521473*^9, 
   3.5938904351731195`*^9}, {3.5938905942222233`*^9, 3.593890646846237*^9}, {
   3.5938907308060493`*^9, 3.593890784446119*^9}, {3.593890816335949*^9, 
   3.5938908268875523`*^9}, {3.593890917729754*^9, 3.5938909528357644`*^9}, {
   3.593890989785878*^9, 3.5938909953521996`*^9}, {3.5938910267619977`*^9, 
   3.593891040145765*^9}, {3.5938910788089786`*^9, 3.5938910846363134`*^9}, {
   3.593891129434874*^9, 3.593891171322276*^9}, {3.593891231742736*^9, 
   3.5938912484456935`*^9}, {3.593891284109733*^9, 3.5938913157345467`*^9}, {
   3.593891406517743*^9, 3.593891450575271*^9}, {3.593891786126484*^9, 
   3.593891855912481*^9}, 3.5938919797265673`*^9, {3.5938920297854414`*^9, 
   3.5938921229447737`*^9}, {3.5938921633910885`*^9, 
   3.5938921999981813`*^9}, {3.5938922418465815`*^9, 
   3.5938922469048715`*^9}, {3.593892308849422*^9, 3.5938923093104568`*^9}, {
   3.593892352676928*^9, 3.593892399141591*^9}, {3.5938925575186586`*^9, 
   3.593892634691079*^9}, {3.5938927430902863`*^9, 3.5938927487536087`*^9}, {
   3.5938940261127605`*^9, 3.5938940398465424`*^9}, {3.5939197472213397`*^9, 
   3.593919840094658*^9}, {3.593919885456256*^9, 3.5939199299538045`*^9}, {
   3.593919964916806*^9, 3.593919982736825*^9}, {3.5939200727269807`*^9, 
   3.5939200818575*^9}, {3.5939201128352785`*^9, 3.59392011342533*^9}, {
   3.59392015295657*^9, 3.5939202137170734`*^9}, {3.593920249395095*^9, 
   3.593920251076194*^9}, {3.593920305441307*^9, 3.593920350844907*^9}, {
   3.593920532878338*^9, 3.5939208253480997`*^9}, {3.5939208841534433`*^9, 
   3.593920929439041*^9}, {3.5939210012391543`*^9, 3.5939210193551917`*^9}, {
   3.5939210605245667`*^9, 3.593921165225544*^9}, {3.593921195280266*^9, 
   3.593921195834296*^9}, {3.593923158403686*^9, 3.5939231596217537`*^9}, {
   3.593923282848813*^9, 3.593923297193633*^9}, {3.593923457851835*^9, 
   3.5939234686784697`*^9}, {3.593923534861244*^9, 3.5939235448368177`*^9}, {
   3.593923915894065*^9, 3.59392394602279*^9}, {3.5939240617934217`*^9, 
   3.593924090570072*^9}, 3.5939241633992352`*^9, {3.5939241971361713`*^9, 
   3.5939242268778696`*^9}, {3.593924303011235*^9, 3.5939243236784177`*^9}, {
   3.5939244740230227`*^9, 3.593924599952257*^9}, {3.5939246655669966`*^9, 
   3.5939247024031053`*^9}, {3.5939247678158517`*^9, 
   3.5939247685769005`*^9}, {3.593924941807816*^9, 3.5939249643121047`*^9}, {
   3.5939250375653*^9, 3.59392503791832*^9}, {3.593965243986782*^9, 
   3.593965287987303*^9}, {3.5939653241853747`*^9, 3.593965332015823*^9}, {
   3.5939653650157104`*^9, 3.593965387904023*^9}, {3.5939654735929317`*^9, 
   3.593965487911751*^9}, {3.593965535199456*^9, 3.5939656085196686`*^9}, {
   3.59396656042817*^9, 3.5939666008814864`*^9}, {3.593966693171769*^9, 
   3.5939668001758966`*^9}, {3.593966882396609*^9, 3.593966884000697*^9}, {
   3.5939669693275857`*^9, 3.5939669726547904`*^9}, 3.5939670334152555`*^9, {
   3.5939670652960835`*^9, 3.593967119277171*^9}, {3.593967176493451*^9, 
   3.593967198188694*^9}, {3.5939672340057383`*^9, 3.5939672479275413`*^9}, {
   3.593967287502805*^9, 3.593967327924122*^9}, {3.5939674675381174`*^9, 
   3.593967468848192*^9}, {3.5939675098095374`*^9, 3.5939676145705557`*^9}, {
   3.5939676647354283`*^9, 3.5939677112680745`*^9}, {3.593967778825945*^9, 
   3.593967787812456*^9}, {3.5939678179831862`*^9, 3.5939678299418697`*^9}, {
   3.593967872319295*^9, 3.59396788347094*^9}, {3.59396792074407*^9, 
   3.5939680029517813`*^9}, {3.5939680350886354`*^9, 
   3.5939680353116317`*^9}, {3.593968091097825*^9, 3.5939681097198925`*^9}, {
   3.5939683685007114`*^9, 3.5939684499313717`*^9}, 3.5939685067806306`*^9, {
   3.5939685615667677`*^9, 3.593968606803376*^9}, {3.5939686460656123`*^9, 
   3.59396866656178*^9}, {3.5939687044269476`*^9, 3.5939687119954004`*^9}, {
   3.593968742628137*^9, 3.593968748657482*^9}, 3.5939688281090283`*^9, {
   3.593969020949075*^9, 3.5939690260763693`*^9}, {3.5939690861488113`*^9, 
   3.5939691754899263`*^9}, {3.593969248305096*^9, 3.5939692644230185`*^9}, {
   3.593971615654684*^9, 3.593971662372341*^9}, {3.5939724158404846`*^9, 
   3.5939724170115557`*^9}, {3.593974256074873*^9, 3.593974279677223*^9}, {
   3.596391026824274*^9, 3.5963910272732954`*^9}, 3.5990900642419386`*^9, {
   3.5990901226752667`*^9, 3.5990901526119814`*^9}, {3.599090954390897*^9, 
   3.5990909547869196`*^9}, {3.5990913473694015`*^9, 3.599091347454423*^9}, {
   3.599091599916864*^9, 3.59909160037689*^9}, {3.5990918883133793`*^9, 
   3.5990918884233875`*^9}, {3.599092668743072*^9, 3.5990927707979155`*^9}, {
   3.5990937319669604`*^9, 3.599093749190946*^9}, {3.599144396990856*^9, 
   3.599144397022108*^9}, {3.5991448474605*^9, 3.5991448491792355`*^9}, {
   3.5992565778328485`*^9, 3.599256577914835*^9}, {3.599260426869246*^9, 
   3.5992604454593105`*^9}, {3.5992639371112704`*^9, 3.599263937546291*^9}, 
   3.5993120427282906`*^9, {3.6020963538337235`*^9, 3.6020963999583864`*^9}, {
   3.6020965305038433`*^9, 3.602096570031107*^9}, 3.6020966140806293`*^9, {
   3.602102131145573*^9, 3.602102150791694*^9}, {3.602102265274254*^9, 
   3.6021023583606033`*^9}, {3.602102426162467*^9, 3.602102453345024*^9}, {
   3.602102491421218*^9, 3.602102512816429*^9}, {3.6021025687546463`*^9, 
   3.6021025976883087`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"frames", " ", "=", " ", 
    RowBox[{"ConstantArray", "[", 
     RowBox[{"0", ",", " ", 
      RowBox[{"{", 
       RowBox[{"n", ",", " ", "6"}], "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"world", " ", 
    RowBox[{"coord", ".", " ", "frame"}], " ", "is", " ", "aligned", " ", 
    "with", " ", 
    RowBox[{"rleg", ":", " ", 
     RowBox[{"ajc", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"rthigh", ":", " ", 
    RowBox[{"ajc", " ", "to", " ", "kjc"}]}], " ", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"frames", "\[LeftDoubleBracket]", 
     RowBox[{"1", ",", " ", "5"}], "\[RightDoubleBracket]"}], " ", "=", "  ", 
    RowBox[{"L", "+", "R"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"frames", " ", "//", " ", "N"}], " ", "//", " ", 
  "MatrixForm"}]}], "Input",
 CellChangeTimes->{{3.5938593516290765`*^9, 3.593859371822229*^9}, 
   3.593859457086112*^9, {3.593859531702386*^9, 3.5938595484463434`*^9}, 
   3.593859728422651*^9, {3.5938599208146677`*^9, 3.5938600193503103`*^9}, {
   3.593860441262472*^9, 3.593860506702219*^9}, {3.5938606833833375`*^9, 
   3.593860729126957*^9}, {3.5938607597357063`*^9, 3.593860855151174*^9}, {
   3.593860890943224*^9, 3.5938608959115086`*^9}, {3.593860965991522*^9, 
   3.5938610380946503`*^9}, {3.593861209230451*^9, 3.593861312447359*^9}, {
   3.5938613586320066`*^9, 3.5938615062434607`*^9}, {3.59386153854531*^9, 
   3.5938615886171727`*^9}, {3.5938620697057247`*^9, 
   3.5938620827614727`*^9}, {3.593862223302523*^9, 3.593862231727001*^9}, {
   3.5938623058712516`*^9, 3.593862411442295*^9}, {3.593862496147148*^9, 
   3.5938625714754624`*^9}, {3.5938626031912737`*^9, 3.593862729051483*^9}, {
   3.5938628170415287`*^9, 3.5938628174255466`*^9}, {3.5938631780081964`*^9, 
   3.5938631933590727`*^9}, {3.5938638804314203`*^9, 3.59386391689251*^9}, {
   3.5938640387894955`*^9, 3.5938640517492275`*^9}, {3.593864261357236*^9, 
   3.5938642779491863`*^9}, 3.5938644271517277`*^9, {3.593864463104785*^9, 
   3.5938645691868773`*^9}, {3.5938646105112305`*^9, 
   3.5938646337825584`*^9}, {3.5938647824240713`*^9, 3.593864808646573*^9}, {
   3.593864951623762*^9, 3.59386497262398*^9}, {3.5938652083664675`*^9, 
   3.593865267975879*^9}, 3.5938810583071356`*^9, 3.5938816884852223`*^9, {
   3.5938817434183683`*^9, 3.593881779394436*^9}, 3.5938900852510786`*^9, {
   3.593890177261346*^9, 3.5938902009737043`*^9}, {3.593890371521473*^9, 
   3.5938904351731195`*^9}, {3.5938905942222233`*^9, 3.593890646846237*^9}, {
   3.5938907308060493`*^9, 3.593890784446119*^9}, {3.593890816335949*^9, 
   3.5938908268875523`*^9}, {3.593890917729754*^9, 3.5938909528357644`*^9}, {
   3.593890989785878*^9, 3.5938909953521996`*^9}, {3.5938910267619977`*^9, 
   3.593891040145765*^9}, {3.5938910788089786`*^9, 3.5938910846363134`*^9}, {
   3.593891129434874*^9, 3.593891171322276*^9}, {3.593891231742736*^9, 
   3.5938912484456935`*^9}, {3.593891284109733*^9, 3.5938913157345467`*^9}, {
   3.593891406517743*^9, 3.593891450575271*^9}, {3.593891786126484*^9, 
   3.593891855912481*^9}, 3.5938919797265673`*^9, {3.5938920297854414`*^9, 
   3.5938921229447737`*^9}, {3.5938921633910885`*^9, 
   3.5938921999981813`*^9}, {3.5938922418465815`*^9, 
   3.5938922469048715`*^9}, {3.593892308849422*^9, 3.5938923093104568`*^9}, {
   3.593892352676928*^9, 3.593892399141591*^9}, {3.5938925575186586`*^9, 
   3.593892634691079*^9}, {3.5938927430902863`*^9, 3.5938927487536087`*^9}, {
   3.5938940261127605`*^9, 3.5938940398465424`*^9}, {3.5939197472213397`*^9, 
   3.593919840094658*^9}, {3.593919885456256*^9, 3.5939199299538045`*^9}, {
   3.593919964916806*^9, 3.593919982736825*^9}, {3.5939200727269807`*^9, 
   3.5939200818575*^9}, {3.5939201128352785`*^9, 3.59392011342533*^9}, {
   3.59392015295657*^9, 3.5939202137170734`*^9}, {3.593920249395095*^9, 
   3.593920251076194*^9}, {3.593920305441307*^9, 3.593920350844907*^9}, {
   3.593920532878338*^9, 3.5939208253480997`*^9}, {3.5939208841534433`*^9, 
   3.593920929439041*^9}, {3.5939210012391543`*^9, 3.5939210193551917`*^9}, {
   3.5939210605245667`*^9, 3.593921165225544*^9}, {3.593921195280266*^9, 
   3.593921195834296*^9}, {3.593923158403686*^9, 3.5939231596217537`*^9}, {
   3.593923282848813*^9, 3.593923297193633*^9}, {3.593923457851835*^9, 
   3.5939234686784697`*^9}, {3.593923534861244*^9, 3.5939235448368177`*^9}, {
   3.593923915894065*^9, 3.59392394602279*^9}, {3.5939240617934217`*^9, 
   3.593924090570072*^9}, 3.5939241633992352`*^9, {3.5939241971361713`*^9, 
   3.5939242268778696`*^9}, {3.593924303011235*^9, 3.5939243236784177`*^9}, {
   3.5939244740230227`*^9, 3.593924599952257*^9}, {3.5939246655669966`*^9, 
   3.5939247024031053`*^9}, {3.5939247678158517`*^9, 
   3.5939247685769005`*^9}, {3.593924941807816*^9, 3.5939249643121047`*^9}, {
   3.5939250375653*^9, 3.59392503791832*^9}, {3.593965243986782*^9, 
   3.593965287987303*^9}, {3.5939653241853747`*^9, 3.593965332015823*^9}, {
   3.5939653650157104`*^9, 3.593965387904023*^9}, {3.5939654735929317`*^9, 
   3.593965487911751*^9}, {3.593965535199456*^9, 3.5939656085196686`*^9}, {
   3.59396656042817*^9, 3.5939666008814864`*^9}, {3.593966693171769*^9, 
   3.5939668001758966`*^9}, {3.593966882396609*^9, 3.593966884000697*^9}, {
   3.5939669693275857`*^9, 3.5939669726547904`*^9}, 3.5939670334152555`*^9, {
   3.5939670652960835`*^9, 3.593967119277171*^9}, {3.593967176493451*^9, 
   3.593967198188694*^9}, {3.5939672340057383`*^9, 3.5939672479275413`*^9}, {
   3.593967287502805*^9, 3.593967327924122*^9}, {3.5939674675381174`*^9, 
   3.593967468848192*^9}, {3.5939675098095374`*^9, 3.5939676145705557`*^9}, {
   3.5939676647354283`*^9, 3.5939677112680745`*^9}, {3.593967778825945*^9, 
   3.593967787812456*^9}, {3.5939678179831862`*^9, 3.5939678299418697`*^9}, {
   3.593967872319295*^9, 3.59396788347094*^9}, {3.59396792074407*^9, 
   3.5939680029517813`*^9}, {3.5939680350886354`*^9, 
   3.5939680353116317`*^9}, {3.593968091097825*^9, 3.5939681097198925`*^9}, {
   3.5939683685007114`*^9, 3.5939684499313717`*^9}, 3.5939685067806306`*^9, 
   3.5939685615667677`*^9, {3.5939708427064013`*^9, 3.593970847810689*^9}, {
   3.59397146328294*^9, 3.5939714922705956`*^9}, {3.5939782205448513`*^9, 
   3.593978300368427*^9}, {3.593978350325285*^9, 3.593978368993357*^9}, {
   3.5939785488236537`*^9, 3.593978555057012*^9}, {3.5940477796373243`*^9, 
   3.5940477799133396`*^9}, 3.5940479436757183`*^9, {3.5963910051110134`*^9, 
   3.59639100737514*^9}, {3.5990903238437886`*^9, 3.59909036682825*^9}, {
   3.599090398642072*^9, 3.599090456376378*^9}, {3.599090575120178*^9, 
   3.5990905833896513`*^9}, {3.599090638092785*^9, 3.599090674576873*^9}, {
   3.5990907045925927`*^9, 3.599090752353327*^9}, {3.599090783199094*^9, 
   3.5990908202692165`*^9}, 3.5990908649307747`*^9, {3.5990909171817665`*^9, 
   3.5990909280253887`*^9}, {3.5990910975800977`*^9, 3.599091185672141*^9}, {
   3.5990913679335794`*^9, 3.5990914774528503`*^9}, {3.599091537246277*^9, 
   3.5990915381383266`*^9}, {3.5990919329199333`*^9, 3.59909196586182*^9}, {
   3.599092143760008*^9, 3.5990922182502737`*^9}, {3.5990922769426355`*^9, 
   3.599092286538184*^9}, {3.5990923401032534`*^9, 3.5990923440374775`*^9}, {
   3.5990924336096067`*^9, 3.599092441881081*^9}, {3.5990927593592625`*^9, 
   3.59909275951827*^9}, {3.599092856944849*^9, 3.599092894408995*^9}, {
   3.599093716240059*^9, 3.5990937264286423`*^9}, {3.5991444462253404`*^9, 
   3.599144453209715*^9}, {3.5991459343416862`*^9, 3.599145964885438*^9}, {
   3.599256591426606*^9, 3.599256615381985*^9}, {3.599260434403682*^9, 
   3.5992604381578927`*^9}, {3.5992639482359076`*^9, 
   3.5992639802987432`*^9}, {3.599312058183173*^9, 3.599312127638155*^9}, {
   3.5993135311115265`*^9, 3.5993135389839725`*^9}, {3.602096413186125*^9, 
   3.602096430815132*^9}, {3.6021023660890307`*^9, 3.6021023713763304`*^9}}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"0.`", "0.`", "0.`", "0.`", "1.5`", "0.`"},
     {"0.`", "0.`", "0.`", "0.`", "0.`", "0.`"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{{3.602102373744465*^9, 3.602102381666919*^9}, 
   3.6021026265779433`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"inertia", " ", "=", " ", 
    RowBox[{"ConstantArray", "[", 
     RowBox[{"0", ",", " ", 
      RowBox[{"{", 
       RowBox[{"n", ",", " ", "10"}], "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"inertia", "\[LeftDoubleBracket]", 
    RowBox[{"1", ",", " ", 
     RowBox[{"{", 
      RowBox[{"1", ",", " ", "6", ",", " ", "10"}], "}"}]}], 
    "\[RightDoubleBracket]"}], " ", "=", "  ", 
   RowBox[{"{", 
    RowBox[{"M", ",", " ", 
     RowBox[{"L", "+", "R"}], ",", "  ", 
     RowBox[{
      RowBox[{"1", "/", "2"}], " ", "M", " ", 
      RowBox[{"R", "^", "2"}]}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"inertia", "\[LeftDoubleBracket]", 
     RowBox[{"2", ",", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", " ", "6", ",", " ", "10"}], "}"}]}], 
     "\[RightDoubleBracket]"}], " ", "=", "  ", 
    RowBox[{"{", 
     RowBox[{"m", ",", " ", 
      RowBox[{"L", "+", "R"}], ",", "  ", 
      RowBox[{
       RowBox[{"1", "/", "2"}], " ", "m", " ", 
       RowBox[{"r", "^", "2"}]}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"inertia", " ", "//", " ", "N"}], "//", " ", 
  "MatrixForm"}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQAGIQbbIrj23nhVeOPukLuEF0hdXOSBDN4Z+cC6IXCloU
guhVDPaVIHqP2IbpIJr77I8FIPqVR85KEF12O2Y1iOaLebwDRAtfu74LRMc1
/98Hom9tE9oPor98DzoMoksetJ0D0Sd+7rwC1se27weIFtD3F9wFpKfVTREF
0X+DTkqC6GvRTVIg+onTNwUQ3dfxA0x3L/7YuhtI29XunQyi68zSDl8C0jXb
go+A6E2fN7VzXnzlOKc+owNES/ROSuEG0j80S1JBdENbgjIvkN5l+EwVRFcf
PXlFBcTvP3cHRHvtzdMtufbKUf1ilwGIbmGytQDRv2wj7UH0u8UqLiDayssB
TPP5m/GVA2k58WlgetEFN3kQrZYdrgyif1xbpQmi1xtYaYNoADL72D4=
  "]],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"1.`", "0.`", "0.`", "0.`", "0.`", "1.5`", "0.`", "0.`", "0.`", 
      "0.125`"},
     {"0.5`", "0.`", "0.`", "0.`", "0.`", "1.5`", "0.`", "0.`", "0.`", 
      "0.0625`"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{3.6021026267099524`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"add", " ", "to", " ", "joint", " ", "library"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"NLink`Private`joint", "[", "\"\<wheel\>\"", "]"}], " ", "=", 
     " ", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1", ",", "R", ",", "0", ",", "0"}], 
      "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"NLink`Private`XJ", "[", "\"\<wheel\>\"", "]"}], " ", "=", " ", 
     RowBox[{
      RowBox[{"NLink`Private`rotZ", "[", "#1", "]"}], ".", 
      RowBox[{"NLink`Private`transX", "[", 
       RowBox[{"R", " ", "#1"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"NLink`Private`dXJ", "[", "\"\<wheel\>\"", "]"}], " ", "=", " ", 
     RowBox[{"D", "[", 
      RowBox[{
       RowBox[{"NLink`Private`XJ", "[", "\"\<wheel\>\"", "]"}], ",", " ", 
       "#1"}], "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"NLink`Private`joint", "[", "\"\<winch\>\"", "]"}], " ", "=", 
     " ", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1", ",", "r", ",", "0", ",", "0"}], 
      "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"NLink`Private`XJ", "[", "\"\<winch\>\"", "]"}], " ", "=", " ", 
     RowBox[{
      RowBox[{"NLink`Private`rotZ", "[", "#1", "]"}], ".", 
      RowBox[{"NLink`Private`transX", "[", 
       RowBox[{"r", " ", "#1"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"NLink`Private`dXJ", "[", "\"\<winch\>\"", "]"}], " ", "=", " ", 
     RowBox[{"D", "[", 
      RowBox[{
       RowBox[{"NLink`Private`XJ", "[", "\"\<winch\>\"", "]"}], ",", " ", 
       "#1"}], "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"robot", " ", "description"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"g", " ", "=", " ", "9.81"}], ";", " ", 
    RowBox[{"(*", " ", 
     RowBox[{"m", "/", 
      RowBox[{"s", "^", "2"}]}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"parent", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"0", ",", " ", "1"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bodies", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"\"\<wheel\>\"", ",", " ", "\"\<winch\>\""}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nd", " ", "=", " ", 
     RowBox[{
      RowBox[{"2", 
       RowBox[{"Length", "@", 
        RowBox[{"NLink`Private`ExpandJoints", "[", "bodies", "]"}]}]}], " ", 
      "+", " ", "1"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"jump", " ", "map"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"b", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"4", ",", " ", "4"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Ximp", " ", "=", " ", 
      RowBox[{"NLink`Private`Xba", "[", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", " ", "0", ",", " ", "0"}], "}"}], ",", " ", 
         "kjc2ajc"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"R", " ", "=", " ", 
      RowBox[{
       RowBox[{"ArrayPad", "[", 
        RowBox[{
         RowBox[{"IdentityMatrix", "[", "2", "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", " ", "0"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"3", ",", " ", "1"}], "}"}]}], "}"}]}], "]"}], ".", 
       "Ximp"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"SetModel", "[", 
      RowBox[{
       RowBox[{"Prepend", "[", 
        RowBox[{
         RowBox[{"Rest", "@", "joints"}], ",", " ", "\"\<fc\>\""}], "]"}], 
       ",", " ", "parent", ",", " ", "b", ",", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", " ", "g", ",", " ", "0"}], "}"}], ",", " ", 
       "inertia", ",", " ", "frames", ",", " ", "R", ",", " ", "nd"}], "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"h", " ", "=", " ", 
      RowBox[{"GetAccelerationFunction", "[", "\"\<Imp\>\"", "]"}]}], ";"}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", "dynamics", " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetModel", "[", 
     RowBox[{"bodies", ",", " ", "parent", ",", " ", 
      RowBox[{"{", "}"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", " ", "g", ",", " ", "0"}], "}"}], ",", " ", 
      "inertia", ",", " ", "frames", ",", " ", 
      RowBox[{"{", "}"}], ",", " ", "nd"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"f", " ", "=", " ", 
     RowBox[{"GetAccelerationFunction", "[", "\"\<FdF\>\"", "]"}]}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.5939714866972804`*^9, 3.593971487376317*^9}, {
   3.593971524080418*^9, 3.59397152427943*^9}, 3.5939716018668756`*^9, {
   3.593971778643999*^9, 3.593971822458508*^9}, {3.593971855738424*^9, 
   3.59397188361001*^9}, {3.5939719236272974`*^9, 3.593971936606046*^9}, {
   3.593972427098134*^9, 3.5939725136320896`*^9}, 3.593972636393119*^9, 
   3.593972923297547*^9, {3.5939729571304874`*^9, 3.5939730216492004`*^9}, {
   3.5939730630595536`*^9, 3.5939730660977273`*^9}, {3.593973159045048*^9, 
   3.5939732317142105`*^9}, {3.59397330595446*^9, 3.593973316547067*^9}, {
   3.5939735435370684`*^9, 3.5939735832653427`*^9}, 3.593973807578189*^9, 
   3.5939739839452887`*^9, {3.593974036820315*^9, 3.5939740689611654`*^9}, {
   3.5939741121276293`*^9, 3.593974117895956*^9}, {3.5939741768503323`*^9, 
   3.593974177552376*^9}, {3.5939742976182528`*^9, 3.593974299141339*^9}, {
   3.5939842677327366`*^9, 3.5939842695248365`*^9}, {3.5939910083707685`*^9, 
   3.593991019849407*^9}, {3.59399394574796*^9, 3.5939939459559765`*^9}, {
   3.593993996296853*^9, 3.5939939964878693`*^9}, {3.5939940819077606`*^9, 
   3.5939941668946238`*^9}, {3.593994212096217*^9, 3.5939942941619167`*^9}, {
   3.5939943430117135`*^9, 3.593994375594598*^9}, {3.5939944171409583`*^9, 
   3.593994569692711*^9}, {3.5939946293561115`*^9, 3.5939947138349447`*^9}, {
   3.593994821560114*^9, 3.593994843696386*^9}, 3.5939948828726287`*^9, {
   3.593994933713541*^9, 3.5939949950320563`*^9}, {3.5939950422967587`*^9, 
   3.593995042999799*^9}, {3.5939950754326563`*^9, 3.593995176469446*^9}, {
   3.5939952594561944`*^9, 3.593995260078231*^9}, {3.5939954167752028`*^9, 
   3.5939954189263268`*^9}, 3.5939958737903757`*^9, {3.5940018452523413`*^9, 
   3.5940018634573836`*^9}, {3.5940364260407205`*^9, 3.59403643929348*^9}, {
   3.59404695976937*^9, 3.5940469730251317`*^9}, {3.594047572538464*^9, 
   3.5940475767457047`*^9}, {3.594047617058014*^9, 3.5940476173430295`*^9}, 
   3.5940494453787184`*^9, {3.5940499948311844`*^9, 3.5940500051277704`*^9}, {
   3.59639250261977*^9, 3.5963925910508366`*^9}, 3.5963926628989487`*^9, {
   3.5963927036002765`*^9, 3.596392705271375*^9}, {3.596392803443016*^9, 
   3.596392805794135*^9}, {3.5990940878003387`*^9, 3.5990941152589087`*^9}, {
   3.5990941752093415`*^9, 3.5990941779595013`*^9}, {3.599094208752265*^9, 
   3.599094217847787*^9}, {3.599094289491886*^9, 3.599094339983778*^9}, 
   3.5990944185712824`*^9, {3.599144869491782*^9, 3.5991448741167912`*^9}, {
   3.5992566576984034`*^9, 3.599256669919103*^9}, {3.5992604825284348`*^9, 
   3.5992605087139378`*^9}, {3.5992640613763866`*^9, 
   3.5992640700028815`*^9}, {3.5993127913501625`*^9, 3.599312816406597*^9}, {
   3.60209670506384*^9, 3.602096707399973*^9}, {3.602096841888675*^9, 
   3.6020969608325067`*^9}, {3.6020971429829183`*^9, 3.602097180502063*^9}, {
   3.602097372311064*^9, 3.602097388141958*^9}, {3.6020974331165323`*^9, 
   3.602097455301817*^9}, {3.6021001065526304`*^9, 3.6021001491510725`*^9}, 
   3.6021002259354687`*^9, {3.6021007104362135`*^9, 3.602100714579451*^9}, {
   3.602101031090576*^9, 3.60210105702608*^9}, {3.6021011261440196`*^9, 
   3.602101156304747*^9}, {3.6021026509113383`*^9, 3.6021026749367175`*^9}, {
   3.6021027230404725`*^9, 3.602102846078514*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"original", " ", "tree"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"TreePlot", "[", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
         "parent", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
         "\[Rule]", " ", "i"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"i", ",", " ", "n"}], "}"}]}], "]"}], ",", " ", "Automatic", 
      ",", " ", "0", ",", " ", 
      RowBox[{"VertexLabeling", "\[Rule]", "True"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"extended", " ", "tree"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TreePlot", "[", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
         "NLink`Private`parent", "\[LeftDoubleBracket]", "i", 
          "\[RightDoubleBracket]"}], "\[Rule]", " ", "i"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"i", ",", " ", "NLink`Private`nq"}], "}"}]}], "]"}], ",", 
      " ", "Automatic", ",", " ", "0", ",", " ", 
      RowBox[{"VertexLabeling", "\[Rule]", "True"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"draw", " ", "figure"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"q0", " ", "=", " ", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"0", ",", " ", "NLink`Private`nq"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"q0", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
     " ", "=", " ", 
     RowBox[{"\[Pi]", "/", "2"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"poi", " ", "=", " ", 
     RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"colors", " ", "=", " ", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"Black", ",", " ", 
       RowBox[{"n", "+", 
        RowBox[{"Length", "@", "poi"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Animate", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"q0", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
       " ", "=", " ", "s"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Graphics", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Disk", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"NLink`Private`GetPoints", "[", "q0", "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}], "\[LeftDoubleBracket]", 
             RowBox[{"1", ";;", "2"}], "\[RightDoubleBracket]"}], ",", " ", 
            "R"}], "]"}], ",", " ", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "5"}], ",", " ", "0"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"5", ",", " ", "0"}], "}"}]}], "}"}], "]"}], ",", " ", 
          "Thick", ",", " ", "Red", ",", " ", 
          RowBox[{"Line", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"NLink`Private`GetPoints", "[", "q0", "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}], "\[LeftDoubleBracket]", 
              RowBox[{"1", ";;", "2"}], "\[RightDoubleBracket]"}], ",", " ", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"NLink`Private`GetPoints", "[", "q0", "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}], 
               "\[LeftDoubleBracket]", 
               RowBox[{"1", ";;", "2"}], "\[RightDoubleBracket]"}], "+", " ", 
              RowBox[{"R", " ", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Sin", "[", "s", "]"}], ",", " ", 
                 RowBox[{"Cos", "[", "s", "]"}]}], "}"}]}]}]}], "}"}], 
           "]"}]}], "}"}], ",", " ", 
        RowBox[{"PlotRange", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "5"}], ",", " ", "5"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "3"}], ",", " ", "5"}], "}"}]}], "}"}]}]}], "]"}]}],
      ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"s", ",", " ", "0", ",", " ", 
       RowBox[{"2", "\[Pi]"}]}], "}"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.596392913000272*^9, 3.596392947509266*^9}, {
   3.596392977521966*^9, 3.596393040975608*^9}, {3.5963930801818404`*^9, 
   3.5963931003000154`*^9}, {3.5963932648354197`*^9, 3.59639326656052*^9}, 
   3.5963933002494516`*^9, {3.5963953038211856`*^9, 3.596395306130316*^9}, {
   3.596395614889999*^9, 3.596395617203129*^9}, {3.5963956537022395`*^9, 
   3.596395685028014*^9}, {3.5963957440353947`*^9, 3.5963957589992523`*^9}, {
   3.5963958143954244`*^9, 3.596395825407055*^9}, {3.5963960368971663`*^9, 
   3.5963960396233225`*^9}, {3.5964196951123285`*^9, 
   3.5964197992844076`*^9}, {3.5964201035506277`*^9, 
   3.5964201048318815`*^9}, {3.5990950906727715`*^9, 
   3.5990951367654114`*^9}, {3.599095235386054*^9, 3.599095408128948*^9}, {
   3.5990954454310846`*^9, 3.599095605352245*^9}, {3.5990956987686*^9, 
   3.5990958499582524`*^9}, {3.5991446361944485`*^9, 
   3.5991446488038635`*^9}, {3.599144687850799*^9, 3.5991446916633077`*^9}, {
   3.5991449206793795`*^9, 3.599144979413869*^9}, {3.599145864133669*^9, 
   3.599145902706876*^9}, {3.59914597539104*^9, 3.5991460193335543`*^9}, {
   3.599256690114256*^9, 3.5992567800174255`*^9}, 3.599256900304294*^9, {
   3.5992569466669493`*^9, 3.599256956369508*^9}, {3.5992571244791346`*^9, 
   3.599257154202833*^9}, 3.5992572159783792`*^9, {3.599260523815807*^9, 
   3.5992606324370203`*^9}, {3.5992641519915895`*^9, 3.59926421073394*^9}, {
   3.599312979682948*^9, 3.5993130584244576`*^9}, {3.5993131065832148`*^9, 
   3.5993131152387114`*^9}, {3.5993131727440224`*^9, 3.599313327683895*^9}, {
   3.599313395063754*^9, 3.5993133964068117`*^9}, 3.599313429586708*^9, {
   3.5993136035916777`*^9, 3.5993136242718563`*^9}, {3.599315494655967*^9, 
   3.5993155028944435`*^9}, {3.5993155332791834`*^9, 3.599315539568545*^9}, {
   3.6021002814066415`*^9, 3.6021004492492576`*^9}, {3.6021006356889334`*^9, 
   3.6021006609693785`*^9}, {3.6021007619371605`*^9, 3.602100888671421*^9}, {
   3.602100930104794*^9, 3.6021009693210583`*^9}, {3.602101190840725*^9, 
   3.6021012440877743`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"t", " ", "=", " ", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"x0", " ", "=", " ", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", " ", "NLink`Private`nx"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dx0", " ", "=", " ", 
   RowBox[{"IdentityMatrix", "[", 
    RowBox[{"{", 
     RowBox[{"NLink`Private`nx", ",", " ", "NLink`Private`n\[Lambda]"}], 
     "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"u0", " ", "=", " ", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", " ", "NLink`Private`nq"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"du0", " ", "=", " ", 
    RowBox[{"ConstantArray", "[", 
     RowBox[{"0", ",", " ", 
      RowBox[{"{", 
       RowBox[{"NLink`Private`nq", ",", " ", "NLink`Private`n\[Lambda]"}], 
       "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NLink`Private`F", "[", 
   RowBox[{"x0", ",", " ", "u0"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"u0", " ", "=", " ", "NLink`Private`c"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"fcn", "[", 
     RowBox[{"s_Real", ",", " ", "q_", ",", " ", "dq_"}], "]"}], " ", ":=", 
    " ", 
    RowBox[{"f", "[", 
     RowBox[{
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"q", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}], ",", " ", 
        RowBox[{"dq", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}]}], "]"}], 
      ",", " ", "u0", ",", " ", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"q", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", " ", 
          RowBox[{"2", ";;"}]}], "\[RightDoubleBracket]"}], ",", " ", 
        RowBox[{"dq", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", " ", 
          RowBox[{"2", ";;"}]}], "\[RightDoubleBracket]"}]}], "]"}], ",", " ",
       "du0"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"FixAngles", ",", " ", "Listable"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FixAngles", "[", "q_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "x", "}"}], ",", " ", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{" ", 
        RowBox[{
        "make", " ", "sure", " ", "angles", " ", "are", " ", "btw", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", "pi"}], " ", "pi"}]}]}], "]"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"x", " ", "=", " ", 
        RowBox[{"Mod", "[", 
         RowBox[{"q", ",", " ", 
          RowBox[{"2", "\[Pi]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"x", ">", "\[Pi]"}], ",", " ", 
         RowBox[{"x", " ", "-", " ", 
          RowBox[{"2", "\[Pi]"}]}], ",", " ", "x"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FixState", "[", "x_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"y", " ", "=", " ", "x"}], ",", " ", "n"}], "}"}], ",", " ", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"n", " ", "=", " ", "NLink`Private`nq"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ListQ", "[", 
          RowBox[{"y", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
           "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"y", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", 
            RowBox[{";;", "n"}]}], "\[RightDoubleBracket]"}], " ", "=", " ", 
          RowBox[{"FixAngles", "[", 
           RowBox[{"y", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", " ", 
             RowBox[{";;", "n"}]}], "\[RightDoubleBracket]"}], "]"}]}], ",", 
         " ", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"y", "\[LeftDoubleBracket]", 
           RowBox[{";;", "n"}], "\[RightDoubleBracket]"}], " ", "=", " ", 
          RowBox[{"FixAngles", "[", 
           RowBox[{"y", "\[LeftDoubleBracket]", 
            RowBox[{";;", "n"}], "\[RightDoubleBracket]"}], "]"}]}]}], "]"}], 
       ";", "\[IndentingNewLine]", "y"}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"nlmap", "[", 
     RowBox[{"x0_", ",", " ", "u_", ",", " ", "t_", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "q", ",", " ", "q0", ",", " ", "dq0", ",", " ", "qimp", ",", " ", 
        "x0imp", ",", " ", "dx0imp", ",", " ", "b", ",", " ", "s", ",", " ", 
        "n"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"n", " ", "=", " ", "NLink`Private`nq"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"q0", " ", "=", " ", 
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"x0", "\[LeftDoubleBracket]", 
             RowBox[{";;", "n"}], "\[RightDoubleBracket]"}], "}"}], ",", " ", 
           RowBox[{
            RowBox[{"dx0", "\[LeftDoubleBracket]", 
             RowBox[{";;", "n"}], "\[RightDoubleBracket]"}], 
            "\[Transpose]"}]}], "]"}], "\[Transpose]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dq0", " ", "=", " ", 
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"x0", "\[LeftDoubleBracket]", 
             RowBox[{
              RowBox[{"n", "+", "1"}], ";;"}], "\[RightDoubleBracket]"}], 
            "}"}], ",", " ", 
           RowBox[{
            RowBox[{"dx0", "\[LeftDoubleBracket]", 
             RowBox[{
              RowBox[{"n", "+", "1"}], ";;"}], "\[RightDoubleBracket]"}], 
            "\[Transpose]"}]}], "]"}], "\[Transpose]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"q", " ", "=", " ", 
          RowBox[{"q", "/.", " ", 
           RowBox[{"First", "@", 
            RowBox[{"NDSolve", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"q", "''"}], "[", "s", "]"}], " ", "\[Equal]", " ", 
                 RowBox[{"fcn", "[", 
                  RowBox[{"s", ",", " ", 
                   RowBox[{"q", "[", "s", "]"}], ",", " ", 
                   RowBox[{
                    RowBox[{"q", "'"}], "[", "s", "]"}]}], "]"}]}], ",", " ", 
                RowBox[{
                 RowBox[{"q", "[", "0", "]"}], " ", "\[Equal]", " ", "q0"}], 
                ",", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"q", "'"}], "[", "0", "]"}], " ", "\[Equal]", " ", 
                 "dq0"}]}], "}"}], ",", " ", "q", ",", " ", 
              RowBox[{"{", 
               RowBox[{"s", ",", " ", "t", ",", " ", "t"}], "}"}]}], 
             "]"}]}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"b", " ", "=", " ", 
          RowBox[{
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"q", "'"}], "[", "t", "]"}], ",", " ", 
             RowBox[{
              RowBox[{"q", "''"}], "[", "t", "]"}]}], "]"}], 
           "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"q", " ", "=", " ", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"q", "[", "t", "]"}], ",", " ", 
            RowBox[{
             RowBox[{"q", "'"}], "[", "t", "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"q", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", " ", 
            RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}], " ", "=", " ", 
          "b"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"x0imp", " ", "=", " ", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"PadLeft", "[", 
             RowBox[{
              RowBox[{"q", "\[LeftDoubleBracket]", 
               RowBox[{
                RowBox[{";;", "n"}], ",", "1"}], "\[RightDoubleBracket]"}], 
              ",", " ", 
              RowBox[{"n", "+", "2"}]}], "]"}], ",", " ", 
            RowBox[{"PadLeft", "[", 
             RowBox[{
              RowBox[{"q", "\[LeftDoubleBracket]", 
               RowBox[{
                RowBox[{
                 RowBox[{"n", "+", "1"}], ";;"}], ",", "1"}], 
               "\[RightDoubleBracket]"}], ",", " ", 
              RowBox[{"n", "+", "2"}]}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"dx0imp", " ", "=", " ", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"ArrayPad", "[", 
             RowBox[{
              RowBox[{"q", "\[LeftDoubleBracket]", 
               RowBox[{
                RowBox[{";;", "n"}], ",", " ", 
                RowBox[{"2", ";;"}]}], "\[RightDoubleBracket]"}], ",", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"2", ",", "0"}], "}"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0"}], "}"}]}], "}"}]}], "]"}], ",", " ", 
            RowBox[{"ArrayPad", "[", 
             RowBox[{
              RowBox[{"q", "\[LeftDoubleBracket]", 
               RowBox[{
                RowBox[{
                 RowBox[{"n", "+", "1"}], ";;"}], ",", " ", 
                RowBox[{"2", ";;"}]}], "\[RightDoubleBracket]"}], ",", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"2", ",", "0"}], "}"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0"}], "}"}]}], "}"}]}], "]"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"qimp", " ", "=", 
          RowBox[{"A", ".", 
           RowBox[{
            RowBox[{"h", "[", 
             RowBox[{"x0imp", ",", " ", "dx0imp"}], "]"}], 
            "\[LeftDoubleBracket]", 
            RowBox[{"3", ";;"}], "\[RightDoubleBracket]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"q", " ", "=", " ", 
          RowBox[{
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"A", ".", 
               RowBox[{"q", "\[LeftDoubleBracket]", 
                RowBox[{
                 RowBox[{";;", "n"}], ",", " ", "1"}], 
                "\[RightDoubleBracket]"}]}], "}"}], ",", " ", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"A", ".", 
                RowBox[{"q", "\[LeftDoubleBracket]", 
                 RowBox[{
                  RowBox[{";;", "n"}], ",", " ", 
                  RowBox[{"2", ";;"}]}], "\[RightDoubleBracket]"}]}], ")"}], 
              "\[Transpose]"}]}], "]"}], "\[Transpose]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"qimp", " ", "=", " ", 
          RowBox[{"Join", "[", 
           RowBox[{"q", ",", " ", "qimp"}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"qimp", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}], ",", 
           " ", 
           RowBox[{"qimp", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", " ", 
             RowBox[{"2", ";;"}]}], "\[RightDoubleBracket]"}]}], "}"}]}], 
        "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"q", "/.", " ", 
        RowBox[{"First", "@", 
         RowBox[{"NDSolve", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"q", "''"}], "[", "s", "]"}], " ", "\[Equal]", " ", 
              RowBox[{"fcn", "[", 
               RowBox[{"s", ",", " ", 
                RowBox[{"q", "[", "s", "]"}], ",", " ", 
                RowBox[{
                 RowBox[{"q", "'"}], "[", "s", "]"}]}], "]"}]}], ",", " ", 
             RowBox[{
              RowBox[{"q", "[", "0", "]"}], " ", "\[Equal]", " ", "q0"}], ",",
              " ", 
             RowBox[{
              RowBox[{
               RowBox[{"q", "'"}], "[", "0", "]"}], " ", "\[Equal]", " ", 
              "dq0"}]}], "}"}], ",", " ", "q", ",", " ", 
           RowBox[{"{", 
            RowBox[{"s", ",", " ", "0", ",", " ", "t"}], "}"}]}], 
          "]"}]}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"MatrixForm", " ", "/@", " ", 
     RowBox[{"nlmap", "[", 
      RowBox[{"x0", ",", " ", "u0", ",", " ", "t"}], "]"}]}], ";"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"x0", "\[LeftDoubleBracket]", 
    RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], " ", "=", " ", 
   RowBox[{"-", "5"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"flow", " ", "=", " ", 
   RowBox[{"nlmap", "[", 
    RowBox[{"x0", ",", " ", "u0", ",", " ", "t"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Animate", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"q", " ", "=", " ", 
     RowBox[{
      RowBox[{"flow", "[", "s", "]"}], "\[LeftDoubleBracket]", 
      RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"p", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"NLink`Private`GetPoints", "[", 
        RowBox[{"{", "q", "}"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "1"}], "]"}], "]"}], "\[LeftDoubleBracket]", 
      RowBox[{"1", ";;", "2"}], "\[RightDoubleBracket]"}]}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Graphics", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Disk", "[", 
         RowBox[{"p", ",", " ", "R"}], "]"}], ",", " ", 
        RowBox[{"Line", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "5"}], ",", " ", "0"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"5", ",", " ", "0"}], "}"}]}], "}"}], "]"}], ",", " ", 
        "Thick", ",", " ", "Red", ",", " ", 
        RowBox[{"Line", "[", 
         RowBox[{"{", 
          RowBox[{"p", ",", " ", 
           RowBox[{"p", "+", " ", 
            RowBox[{"R", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Sin", "[", "q", "]"}], ",", " ", 
               RowBox[{"Cos", "[", "q", "]"}]}], "}"}]}]}]}], "}"}], "]"}]}], 
       "}"}], ",", " ", 
      RowBox[{"PlotRange", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "5"}], ",", " ", "5"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "3"}], ",", " ", "5"}], "}"}]}], "}"}]}]}], "]"}]}], 
   ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{"s", ",", " ", "0", ",", " ", "t"}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.5934327045113277`*^9, 3.5934327084331985`*^9}, {
   3.5934327519176607`*^9, 3.593432753464552*^9}, {3.5935408083970065`*^9, 
   3.5935408140845175`*^9}, {3.5935408457877045`*^9, 
   3.5935409170690937`*^9}, {3.5935409973036256`*^9, 
   3.5935410666943865`*^9}, {3.593541212991548*^9, 3.593541213241548*^9}, {
   3.5935413226167593`*^9, 3.593541328554273*^9}, {3.5935413756793656`*^9, 
   3.593541380648125*^9}, {3.5935414338669806`*^9, 3.5935414531638927`*^9}, {
   3.593541502773365*^9, 3.593541502929615*^9}, {3.5935417309613085`*^9, 
   3.5935418191646137`*^9}, 3.59354188669599*^9, {3.593542026633766*^9, 
   3.593542042790058*^9}, {3.5935420897276373`*^9, 3.5935421035870404`*^9}, {
   3.5935421404152365`*^9, 3.5935421406496134`*^9}, {3.5935421811028166`*^9, 
   3.593542199055976*^9}, {3.593542272993637*^9, 3.5935422965249166`*^9}, {
   3.593547315228881*^9, 3.59354737821338*^9}, {3.593547445385391*^9, 
   3.5935474606197915`*^9}, {3.593547616901346*^9, 3.593547647698282*^9}, {
   3.5935476890161934`*^9, 3.5935477018755937`*^9}, 3.5935479795636415`*^9, 
   3.5935480249387393`*^9, {3.5935480660212097`*^9, 3.593548264287224*^9}, {
   3.5935486464285917`*^9, 3.5935486468035903`*^9}, {3.5935487161474805`*^9, 
   3.593548719803738*^9}, {3.593548763803824*^9, 3.593548832788334*^9}, {
   3.5935489513666897`*^9, 3.593548993835524*^9}, {3.5935490353668556`*^9, 
   3.5935490426324944`*^9}, {3.5936176020798597`*^9, 3.593617605979084*^9}, {
   3.5936179261994033`*^9, 3.593617928673545*^9}, 3.5936248538513837`*^9, {
   3.593726382832244*^9, 3.5937264084572945`*^9}, {3.594049711607961*^9, 
   3.59404989581651*^9}, {3.5940501759735537`*^9, 3.594050193207538*^9}, {
   3.5940502267264605`*^9, 3.5940502730591145`*^9}, {3.5940503783631425`*^9, 
   3.594050379272209*^9}, {3.5940504785658965`*^9, 3.5940505324579687`*^9}, {
   3.594050571111182*^9, 3.594050588141155*^9}, {3.5940758440236006`*^9, 
   3.5940759024839478`*^9}, {3.5940774721328373`*^9, 3.594077486589665*^9}, {
   3.59407900804679*^9, 3.594079014623188*^9}, {3.59407937052155*^9, 
   3.594079377502968*^9}, {3.594145582036493*^9, 3.594145585333376*^9}, 
   3.594386490927598*^9, {3.594392637182137*^9, 3.5943927444082785`*^9}, {
   3.5943930375450644`*^9, 3.5943930404882336`*^9}, {3.5943931265931644`*^9, 
   3.594393159575057*^9}, {3.5944713902816973`*^9, 3.59447139348188*^9}, {
   3.594477009898514*^9, 3.594477031024723*^9}, {3.594477156078885*^9, 
   3.5944771614702115`*^9}, {3.594477356497361*^9, 3.594477368394045*^9}, {
   3.5944774223181486`*^9, 3.5944774503367357`*^9}, 3.5944774978524566`*^9, {
   3.594480656743355*^9, 3.5944806736873255`*^9}, 3.59451450259223*^9, {
   3.5945154785301037`*^9, 3.5945155230636516`*^9}, {3.594515578593834*^9, 
   3.594515579657888*^9}, {3.594516252753438*^9, 3.594516291386649*^9}, {
   3.5953351207851534`*^9, 3.5953351225507803`*^9}, {3.595335347316845*^9, 
   3.595335347676221*^9}, {3.5953354480982933`*^9, 3.5953354671920795`*^9}, 
   3.595336378271999*^9, {3.595337776180505*^9, 3.59533779886806*^9}, {
   3.5953398317795987`*^9, 3.59533983318587*^9}, {3.595447707094181*^9, 
   3.595447716922309*^9}, {3.595541643929057*^9, 3.5955416464603157`*^9}, {
   3.595595188133336*^9, 3.595595198512932*^9}, {3.5955981241554728`*^9, 
   3.5955981372592225`*^9}, {3.5955982741950703`*^9, 3.595598280692438*^9}, 
   3.595598332283391*^9, {3.5956366220002303`*^9, 3.5956366310783753`*^9}, {
   3.5964550551488476`*^9, 3.596455056711353*^9}, {3.599095915286994*^9, 
   3.599095934022067*^9}, {3.5990959775595603`*^9, 3.599095978568618*^9}, {
   3.599096093449216*^9, 3.5990961002005835`*^9}, {3.5990968254771338`*^9, 
   3.599096833187563*^9}, {3.59909703088488*^9, 3.5990970589154825`*^9}, {
   3.5991765254594927`*^9, 3.599176531010812*^9}, {3.602101729407567*^9, 
   3.6021017354139104`*^9}, {3.60210176747275*^9, 3.6021019221226025`*^9}, {
   3.6021019633059607`*^9, 3.602102070290107*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"implicit", " ", "function", " ", "for", " ", "time"}], "-", 
    RowBox[{"based", " ", "passive", " ", "brachiation"}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"root", "[", 
     RowBox[{"\[Lambda]_", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "x0", ",", " ", "t", ",", " ", "M", ",", " ", "root", ",", " ", 
        "droot"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"x0", " ", "=", " ", 
        RowBox[{"\[Lambda]", "\[LeftDoubleBracket]", 
         RowBox[{"1", ";;", 
          RowBox[{"-", "2"}]}], "\[RightDoubleBracket]"}]}], ";", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"t", " ", "=", " ", 
        RowBox[{"\[Lambda]", "\[LeftDoubleBracket]", 
         RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"M", " ", "=", " ", 
        RowBox[{"nlmap", "[", 
         RowBox[{"x0", ",", " ", "0", ",", " ", "t", ",", " ", "opts"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"root", " ", "=", " ", 
        RowBox[{"FixState", "[", 
         RowBox[{
          RowBox[{"M", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
           " ", "-", " ", "x0"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"droot", " ", "=", " ", 
        RowBox[{
         RowBox[{"M", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
         " ", "-", " ", "dx0"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "for", " ", "passive", " ", "we", " ", "only", " ", "want", " ", 
         "dxdx0", " ", "and", " ", "dxdt"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"also", " ", "return", " ", "eigenvalues"}], ",", " ", 
         RowBox[{"since", " ", 
          RowBox[{"it", "'"}], "ll", " ", "be", " ", "useful", " ", 
          "later"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"root", ",", " ", "droot", ",", " ", 
         RowBox[{"Eigenvalues", "[", 
          RowBox[{"M", "\[LeftDoubleBracket]", 
           RowBox[{"2", ",", " ", "All", ",", " ", 
            RowBox[{";;", 
             RowBox[{"-", "2"}]}]}], "\[RightDoubleBracket]"}], "]"}]}], 
        "}"}]}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"MatrixForm", " ", "/@", " ", 
     RowBox[{"root", "[", 
      RowBox[{"Append", "[", 
       RowBox[{"x0", ",", " ", "t"}], "]"}], "]"}]}], "*)"}]}]}]], "Input",
 CellChangeTimes->{
  3.5934312738149257`*^9, {3.5934313239727993`*^9, 3.5934314039413786`*^9}, {
   3.593431501535965*^9, 3.5934315847937355`*^9}, {3.5934316543377314`*^9, 
   3.5934316695945916`*^9}, {3.5934318135148335`*^9, 
   3.5934318196831827`*^9}, {3.5934326286674175`*^9, 3.593432634433052*^9}, {
   3.593549137398304*^9, 3.5935491461639643`*^9}, {3.59354921957034*^9, 
   3.593549235164121*^9}, 3.593549546569151*^9, {3.5935495822567225`*^9, 
   3.593549589819237*^9}, {3.5936179716430025`*^9, 3.593617974368159*^9}, {
   3.5936205097493544`*^9, 3.593620509857373*^9}, {3.593622967969387*^9, 
   3.593622968052394*^9}, 3.593624864144973*^9, {3.594050620289998*^9, 
   3.5940506480305896`*^9}, {3.59407564912844*^9, 3.59407566282322*^9}, {
   3.594079388578582*^9, 3.594079391150732*^9}, 3.5945158281561193`*^9, {
   3.5964550608207335`*^9, 3.5964550625707397`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"dfdh", "[", 
    RowBox[{"x0_", ",", " ", "u_", ",", " ", "t_", ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "q0", ",", " ", "dq0", ",", " ", "qimp", ",", " ", "x0imp", ",", " ", 
       "dx0imp", ",", " ", "b", ",", " ", "s", ",", " ", "df", ",", " ", "dh",
        ",", " ", "n"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"n", " ", "=", " ", "NLink`Private`nq"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q0", " ", "=", " ", 
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"x0", "\[LeftDoubleBracket]", 
            RowBox[{";;", "n"}], "\[RightDoubleBracket]"}], "}"}], ",", " ", 
          RowBox[{
           RowBox[{"dx0", "\[LeftDoubleBracket]", 
            RowBox[{";;", "n"}], "\[RightDoubleBracket]"}], 
           "\[Transpose]"}]}], "]"}], "\[Transpose]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dq0", " ", "=", " ", 
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"x0", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{"n", "+", "1"}], ";;"}], "\[RightDoubleBracket]"}], 
           "}"}], ",", " ", 
          RowBox[{
           RowBox[{"dx0", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{"n", "+", "1"}], ";;"}], "\[RightDoubleBracket]"}], 
           "\[Transpose]"}]}], "]"}], "\[Transpose]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"df", " ", "=", " ", 
       RowBox[{"fcn", "[", 
        RowBox[{"0.", ",", " ", "q0", ",", " ", "dq0"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"df", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", " ", 
         RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}], " ", "=", " ", 
       RowBox[{"df", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"df", " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{"dq0", ",", " ", "df"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"x0imp", " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"PadLeft", "[", 
          RowBox[{
           RowBox[{"x0", "\[LeftDoubleBracket]", 
            RowBox[{";;", "n"}], "\[RightDoubleBracket]"}], ",", " ", 
           RowBox[{"n", "+", "2"}]}], "]"}], ",", " ", 
         RowBox[{"PadLeft", "[", 
          RowBox[{
           RowBox[{"x0", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{"n", "+", "1"}], ";;"}], "\[RightDoubleBracket]"}], ",", 
           " ", 
           RowBox[{"n", "+", "2"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dx0imp", " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"ArrayPad", "[", 
          RowBox[{
           RowBox[{"dx0", "\[LeftDoubleBracket]", 
            RowBox[{";;", "n"}], "\[RightDoubleBracket]"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"2", ",", "0"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}]}], "}"}]}], "]"}], ",", " ", 
         RowBox[{"ArrayPad", "[", 
          RowBox[{
           RowBox[{"dx0", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{"n", "+", "1"}], ";;"}], "\[RightDoubleBracket]"}], ",", 
           " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"2", ",", "0"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}]}], "}"}]}], "]"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"qimp", " ", "=", 
       RowBox[{"A", ".", 
        RowBox[{
         RowBox[{"h", "[", 
          RowBox[{"x0imp", ",", " ", "dx0imp"}], "]"}], 
         "\[LeftDoubleBracket]", 
         RowBox[{"3", ";;"}], "\[RightDoubleBracket]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dh", " ", "=", " ", 
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"A", ".", 
            RowBox[{"x0", "\[LeftDoubleBracket]", 
             RowBox[{";;", "n"}], "\[RightDoubleBracket]"}]}], "}"}], ",", 
          " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"A", ".", 
             RowBox[{"dx0", "\[LeftDoubleBracket]", 
              RowBox[{";;", "n"}], "\[RightDoubleBracket]"}]}], ")"}], 
           "\[Transpose]"}]}], "]"}], "\[Transpose]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dh", " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{"dh", ",", " ", "qimp"}], "]"}]}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"df", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", " ", 
          RowBox[{"2", ";;", 
           RowBox[{"-", "2"}]}]}], "\[RightDoubleBracket]"}], ",", " ", 
        RowBox[{"dh", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", " ", 
          RowBox[{"2", ";;", 
           RowBox[{"-", "2"}]}]}], "\[RightDoubleBracket]"}]}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"df", ",", " ", "dh"}], "}"}], " ", "=", "  ", 
   RowBox[{"dfdh", "[", 
    RowBox[{"x0", ",", " ", "u0", ",", " ", "t"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"cost", "[", "s_Real", "]"}], " ", ":=", " ", 
    RowBox[{"Det", "[", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"dh", ".", 
        RowBox[{"MatrixExp", "[", 
         RowBox[{"df", " ", "s"}], "]"}]}], " ", "-", " ", 
       RowBox[{"dx0", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", " ", 
         RowBox[{";;", 
          RowBox[{"-", "2"}]}]}], "\[RightDoubleBracket]"}]}], ")"}], "]"}]}],
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"cost", "[", "s_Real", "]"}], " ", ":=", " ", 
     RowBox[{"Times", "@@", 
      RowBox[{"Abs", "@", 
       RowBox[{"Eigenvalues", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"dh", ".", 
            RowBox[{"MatrixExp", "[", 
             RowBox[{"df", " ", "s"}], "]"}]}], " ", "-", " ", 
           RowBox[{"dx0", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", " ", 
             RowBox[{";;", 
              RowBox[{"-", "2"}]}]}], "\[RightDoubleBracket]"}]}], ")"}], ",",
          " ", 
         RowBox[{"{", 
          RowBox[{"-", "1"}], "}"}]}], "]"}]}]}]}], ";"}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"cost", "[", "s", "]"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{"s", ",", " ", "1.2", ",", " ", "1.3"}], "}"}], ",", " ", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.593720701905258*^9, 3.593720820952364*^9}, {
   3.5937208573586864`*^9, 3.593721007687105*^9}, {3.593721103124792*^9, 
   3.5937211136873093`*^9}, {3.593721164843659*^9, 3.5937211702030487`*^9}, {
   3.593721231468809*^9, 3.5937212562188544`*^9}, 3.593721290172046*^9, {
   3.593721323656475*^9, 3.593721450766097*^9}, {3.5937215103443336`*^9, 
   3.593721514984972*^9}, {3.593721547110035*^9, 3.593721564031944*^9}, {
   3.5937218375949774`*^9, 3.5937218376887293`*^9}, {3.5937219745952463`*^9, 
   3.5937219877202673`*^9}, {3.5937220378922453`*^9, 
   3.5937221581893535`*^9}, {3.5937221944550505`*^9, 3.593722229189494*^9}, {
   3.593722414689872*^9, 3.5937224149867353`*^9}, {3.5937224922056465`*^9, 
   3.5937225514401245`*^9}, {3.5937225816433077`*^9, 
   3.5937225848152027`*^9}, {3.5937226373934174`*^9, 
   3.5937226483778152`*^9}, {3.5937226977529106`*^9, 
   3.5937227178935747`*^9}, {3.593739325124157*^9, 3.5937393894055324`*^9}, {
   3.594050676032209*^9, 3.594050701359641*^9}, {3.594050745436165*^9, 
   3.594050903647225*^9}, {3.5940765653219037`*^9, 3.5940765859941053`*^9}, {
   3.5940792979193907`*^9, 3.5940793107591286`*^9}, {3.59408450357438*^9, 
   3.5940845489025917`*^9}, {3.5940846323715034`*^9, 3.594084658418431*^9}, {
   3.5941456428334846`*^9, 3.5941456448178625`*^9}, {3.5943865892402906`*^9, 
   3.5943866047715707`*^9}, {3.5943867067873955`*^9, 
   3.5943867178186674`*^9}, {3.594390102814003*^9, 3.594390243236044*^9}, {
   3.59439544554732*^9, 3.5943955582975397`*^9}, {3.594395794295252*^9, 
   3.594395814717167*^9}, {3.594395847748481*^9, 3.5943958839985523`*^9}, {
   3.594408898281626*^9, 3.594408986422424*^9}, {3.5944239488347893`*^9, 
   3.594423948944167*^9}, {3.594430141558792*^9, 3.5944301528556757`*^9}, {
   3.594430212715166*^9, 3.594430294215325*^9}, {3.5944371400575504`*^9, 
   3.5944372032920628`*^9}, {3.5944374625113077`*^9, 
   3.5944374775113497`*^9}, {3.5944375700584097`*^9, 3.594437589183429*^9}, {
   3.5944380304030457`*^9, 3.594438041106189*^9}, 3.594438704857486*^9, {
   3.5944707404014807`*^9, 3.5944707936485295`*^9}, {3.5944708743541512`*^9, 
   3.594470874497159*^9}, {3.5944712856297045`*^9, 3.5944712917000494`*^9}, {
   3.5945145732592583`*^9, 3.5945146423352156`*^9}, {3.594515710375377*^9, 
   3.594515735698827*^9}, {3.5953326757349586`*^9, 3.59533267595372*^9}, {
   3.5953365299754114`*^9, 3.595336531662924*^9}, {3.595337883149459*^9, 
   3.595337906493272*^9}, {3.59533897231487*^9, 3.5953389873930244`*^9}, {
   3.5953391237526655`*^9, 3.595339127221422*^9}, {3.5954477508442497`*^9, 
   3.595447799375594*^9}, {3.595448173973174*^9, 3.5954481801095257`*^9}, {
   3.5954492288060675`*^9, 3.5954492504779854`*^9}, {3.5955388622743626`*^9, 
   3.5955388643837414`*^9}, {3.595542749572239*^9, 3.595542756541005*^9}, {
   3.595547908890904*^9, 3.5955479107190337`*^9}, {3.595547977922291*^9, 
   3.5955480134223595`*^9}, {3.595549803604497*^9, 3.595549851401467*^9}, {
   3.5955498901671677`*^9, 3.595549950979786*^9}, {3.5955501244488745`*^9, 
   3.595550239058473*^9}, {3.5955503087617345`*^9, 3.595550346918078*^9}, {
   3.595551012122486*^9, 3.59555122638853*^9}, {3.5955512974824185`*^9, 
   3.5955514279045486`*^9}, {3.595551785139623*^9, 3.595551892483582*^9}, {
   3.5955522662811885`*^9, 3.5955522688593187`*^9}, {3.595552654781947*^9, 
   3.5955526791101246`*^9}, {3.5955527190008235`*^9, 3.595552850297955*^9}, {
   3.595552888157404*^9, 3.595552898969925*^9}, {3.5955531829704804`*^9, 
   3.595553214642418*^9}, {3.595553283111303*^9, 3.5955534016115336`*^9}, {
   3.5955917015527287`*^9, 3.595591736802808*^9}, {3.5955917937872753`*^9, 
   3.595591808506054*^9}, {3.5955918487873816`*^9, 3.595591854396767*^9}, {
   3.5955919660220065`*^9, 3.595592037428378*^9}, {3.5955928593329287`*^9, 
   3.595592973426898*^9}, {3.5955943385966825`*^9, 3.595594351839445*^9}, {
   3.5955944596506195`*^9, 3.5955944597646255`*^9}, {3.5955944916564703`*^9, 
   3.5955946065210295`*^9}, {3.5955949821775427`*^9, 
   3.5955949850187044`*^9}, {3.595595029999278*^9, 3.595595043362049*^9}, {
   3.5955952110046463`*^9, 3.59559521973415*^9}, {3.595595398666393*^9, 
   3.5955953994274364`*^9}, {3.5955954693864403`*^9, 3.595595474707766*^9}, 
   3.595595512066887*^9, {3.595595836974497*^9, 3.595595852734396*^9}, {
   3.595595993600466*^9, 3.595596001202916*^9}, {3.59559674390543*^9, 
   3.5955967810535755`*^9}, {3.5955984066616507`*^9, 
   3.5955984630448794`*^9}, {3.5955985195861173`*^9, 
   3.5955986245601377`*^9}, {3.595599018852706*^9, 3.5955990361106925`*^9}, {
   3.59559907649401*^9, 3.5955990826703644`*^9}, {3.5955991395606213`*^9, 
   3.5955993206389914`*^9}, 3.595599359952242*^9, {3.5955997682226195`*^9, 
   3.5955997685876427`*^9}, {3.5955998255759068`*^9, 
   3.5955998636840897`*^9}, {3.595605470873905*^9, 3.595605472737031*^9}, {
   3.595605844108759*^9, 3.5956058466087627`*^9}, {3.595631298876879*^9, 
   3.595631336517576*^9}, {3.5956366457034044`*^9, 3.5956366534534187`*^9}, {
   3.5956813235692234`*^9, 3.5956813473036456`*^9}, {3.5963124318407254`*^9, 
   3.5963124503117833`*^9}, {3.596422834836792*^9, 3.596422889208906*^9}, {
   3.5964229728386927`*^9, 3.5964229990121913`*^9}, {3.5990971072142515`*^9, 
   3.5990973496671333`*^9}, 3.5991764709453683`*^9, {3.5991765445905895`*^9, 
   3.5991765930313625`*^9}, {3.5991766560749702`*^9, 3.599176770417521*^9}, {
   3.599177375745186*^9, 3.5991773837686477`*^9}, {3.5993136659892483`*^9, 
   3.5993136843333006`*^9}, {3.5993156088225093`*^9, 
   3.5993156155068927`*^9}, {3.599315684857864*^9, 3.5993156867169704`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"tol", " ", "=", " ", "Automatic"}], ";", 
  RowBox[{"10", "^", 
   RowBox[{"-", "8"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"t", " ", "=", " ", 
  RowBox[{"Chop", "[", 
   RowBox[{"s", " ", "/.", " ", 
    RowBox[{"First", "[", 
     RowBox[{"FindRoot", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"cost", "[", "s", "]"}], " ", "\[Equal]", " ", "0"}], ",", 
       " ", 
       RowBox[{"{", 
        RowBox[{"s", ",", " ", "1.2"}], "}"}], ",", " ", 
       RowBox[{"AccuracyGoal", "\[Rule]", "15"}], ",", 
       RowBox[{"PrecisionGoal", "\[Rule]", "15"}], ",", " ", 
       RowBox[{"MaxIterations", "\[Rule]", "5000"}]}], "]"}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"NullSpace", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"root", "[", 
        RowBox[{"Append", "[", 
         RowBox[{"x0", ",", " ", "t"}], "]"}], "]"}], "\[LeftDoubleBracket]", 
       "2", "\[RightDoubleBracket]"}], ",", " ", 
      RowBox[{"Tolerance", "\[Rule]", "tol"}]}], "]"}], " ", "//", " ", 
    "Chop"}], " ", "//", " ", "MatrixForm"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"cost", "[", "t", "]"}]}], "Input",
 CellChangeTimes->{{3.593551215657552*^9, 3.5935513008344297`*^9}, {
   3.593551334527358*^9, 3.593551490641302*^9}, {3.5935515210690455`*^9, 
   3.5935515225991287`*^9}, {3.593551602901745*^9, 3.5935516036407747`*^9}, {
   3.593551679792136*^9, 3.5935516953780327`*^9}, {3.593612580912015*^9, 
   3.5936125990700336`*^9}, {3.5936170361974363`*^9, 
   3.5936170370054793`*^9}, {3.5936175285846314`*^9, 
   3.5936175287836447`*^9}, {3.5936206660443044`*^9, 
   3.5936206673993793`*^9}, {3.5936233250838356`*^9, 
   3.5936233254778576`*^9}, {3.5936235361309214`*^9, 
   3.5936235493946857`*^9}, {3.5936242980025516`*^9, 3.593624322975994*^9}, 
   3.593626646601051*^9, {3.59362672628262*^9, 3.593626727341673*^9}, 
   3.593709434563554*^9, {3.5937390869830637`*^9, 3.593739101233094*^9}, {
   3.5937392984366035`*^9, 3.5937393164678926`*^9}, {3.5937403285011206`*^9, 
   3.5937403546105604`*^9}, {3.593740552907818*^9, 3.5937406232204475`*^9}, {
   3.59405092608451*^9, 3.594050926950559*^9}, {3.594076038317727*^9, 
   3.5940760383487306`*^9}, {3.594076595132614*^9, 3.594076596167673*^9}, {
   3.5940793209017096`*^9, 3.594079321551746*^9}, {3.594084556246356*^9, 
   3.594084672605961*^9}, {3.5940847964812*^9, 3.5940848216218767`*^9}, {
   3.594145652286627*^9, 3.5941456523647876`*^9}, 3.5943902529455976`*^9, {
   3.594395828170331*^9, 3.5943958282953176`*^9}, {3.5943958629047604`*^9, 
   3.594395864576639*^9}, {3.5943959067017345`*^9, 3.594395921279877*^9}, {
   3.5944089957974415`*^9, 3.594409001109955*^9}, {3.5944241186944985`*^9, 
   3.594424168741475*^9}, {3.594424240397872*^9, 3.594424248007265*^9}, {
   3.594430170293208*^9, 3.594430203262025*^9}, {3.5944302756527863`*^9, 
   3.594430276605919*^9}, {3.594437226229597*^9, 3.594437228495224*^9}, {
   3.59443727851095*^9, 3.594437301714117*^9}, {3.594437365011116*^9, 
   3.594437366026746*^9}, {3.5944374858082294`*^9, 3.5944374926676154`*^9}, {
   3.59443752327705*^9, 3.5944375547927365`*^9}, {3.594437776277548*^9, 
   3.5944377852775645`*^9}, {3.5944380497155824`*^9, 3.5944380571687193`*^9}, 
   3.5953365414754314`*^9, {3.5953368836263185`*^9, 3.595336883704444*^9}, {
   3.595336927579531*^9, 3.5953369284701567`*^9}, {3.595338994189911*^9, 
   3.5953390192837133`*^9}, {3.595339070752561*^9, 3.5953391100807657`*^9}, {
   3.5953391442839575`*^9, 3.5953391982059507`*^9}, {3.5953392312372494`*^9, 
   3.5953392331278753`*^9}, {3.595340282834173*^9, 3.5953402994279556`*^9}, {
   3.59544777923493*^9, 3.595447833953805*^9}, {3.5954492593373575`*^9, 
   3.595449275446783*^9}, {3.595545919406066*^9, 3.595545920968568*^9}, {
   3.5955497751356907`*^9, 3.5955497854482117`*^9}, 3.5955511575758944`*^9, {
   3.5955528602354765`*^9, 3.59555286832924*^9}, 3.595553256204998*^9, {
   3.5955920572721663`*^9, 3.595592101194127*^9}, {3.595592136162945*^9, 
   3.5955921918661795`*^9}, {3.5955928292078667`*^9, 
   3.5955928438328915`*^9}, {3.595596261900828*^9, 3.5955962622188444`*^9}, 
   3.5955968122813497`*^9, {3.595596844102168*^9, 3.595596874146886*^9}, {
   3.59559705122303*^9, 3.595597052635129*^9}, {3.595597148519599*^9, 
   3.595597180905453*^9}, {3.5955972228678565`*^9, 3.595597224227936*^9}, {
   3.5955984760226192`*^9, 3.595598501420078*^9}, 3.5955985462686434`*^9, {
   3.595598642580179*^9, 3.5955986572860003`*^9}, {3.595598694626143*^9, 
   3.5955986947921505`*^9}, {3.5955989941302905`*^9, 
   3.5955990273871946`*^9}, {3.5955990654543953`*^9, 3.595599156159571*^9}, {
   3.595599218910166*^9, 3.5955992189861693`*^9}, {3.595599332197653*^9, 
   3.5955993384340096`*^9}, {3.595605520191727*^9, 3.595605520849764*^9}, {
   3.5956058578119226`*^9, 3.5956058703275566`*^9}, {3.5956313440175943`*^9, 
   3.5956313447675953`*^9}, {3.5956380767050524`*^9, 3.595638076767552*^9}, {
   3.596422897563384*^9, 3.596422897717393*^9}, {3.5964230114359055`*^9, 
   3.5964230115359087`*^9}, {3.596423049177064*^9, 3.596423059828676*^9}, {
   3.599097355953496*^9, 3.599097360289744*^9}, {3.5990974134977913`*^9, 
   3.5990974420484233`*^9}, {3.5991766015288625`*^9, 
   3.5991766286013985`*^9}, {3.599176675442079*^9, 3.5991766755700865`*^9}, {
   3.5991767427439337`*^9, 3.599176744277038*^9}, {3.5991767785819883`*^9, 
   3.599176786353435*^9}, {3.599177356870103*^9, 3.5991773704778876`*^9}, {
   3.5993137639458575`*^9, 3.5993137816568713`*^9}, {3.59931561969013*^9, 
   3.5993156771704197`*^9}, {3.6005698728507423`*^9, 3.6005699717864075`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"example", " ", "usage"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"m", " ", "=", " ", "250"}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "try", " ", "to", " ", "generate", " ", "m", " ", "points", " ", "on", 
     " ", "the", " ", "curve"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"step", " ", "=", " ", 
     RowBox[{"1", "/", "10"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nlroot", "[", "root", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Z", " ", "=", " ", 
     RowBox[{"nlcurve", "[", 
      RowBox[{"\"\<nlsln\>\"", ",", " ", "nlc", ",", " ", 
       RowBox[{"Append", "[", 
        RowBox[{"x0", ",", " ", "t"}], "]"}], ",", " ", "step", ",", " ", "m",
        ",", " ", 
       RowBox[{"Select", "\[Rule]", " ", "1"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Beep", "[", "]"}]}]}]], "Input",
 CellChangeTimes->{
  3.5934312738149257`*^9, {3.5934313239727993`*^9, 3.5934314039413786`*^9}, {
   3.593431501535965*^9, 3.5934315847937355`*^9}, {3.5934316543377314`*^9, 
   3.5934316695945916`*^9}, {3.5934318135148335`*^9, 
   3.5934318196831827`*^9}, {3.5934326286674175`*^9, 3.5934326414643188`*^9}, 
   3.5937104030346975`*^9, {3.5937378262452602`*^9, 3.593737836354642*^9}, {
   3.593737943479853*^9, 3.5937379473392334`*^9}, {3.5937391694051003`*^9, 
   3.5937391715457335`*^9}, {3.593740669501786*^9, 3.5937406696736608`*^9}, {
   3.5937431966786156`*^9, 3.593743208288003*^9}, {3.5937468532289767`*^9, 
   3.5937468535883317`*^9}, 3.5937544448650475`*^9, {3.5940509685469418`*^9, 
   3.5940509687119513`*^9}, {3.5940749853282967`*^9, 3.594074991442649*^9}, 
   3.5940754266136923`*^9, 3.594075489214282*^9, 3.5940760634481664`*^9, {
   3.5940761753945956`*^9, 3.5940761755445867`*^9}, 3.59407648159113*^9, {
   3.594076647181591*^9, 3.5940766480116386`*^9}, {3.5940767999293413`*^9, 
   3.5940768075597973`*^9}, {3.594079344628063*^9, 3.5940793577558146`*^9}, {
   3.594079595908461*^9, 3.594079621475924*^9}, 3.5940848882157555`*^9, 
   3.5940856781214404`*^9, 3.5941456746304235`*^9, {3.5941457478493137`*^9, 
   3.5941457504899454`*^9}, 3.5941465800228148`*^9, {3.5941614532248907`*^9, 
   3.5941615144833803`*^9}, 3.5941822543180695`*^9, {3.5943906435609694`*^9, 
   3.5943906444730196`*^9}, {3.5943912110964704`*^9, 
   3.5943912197849655`*^9}, {3.594391280849465*^9, 3.5943912809214687`*^9}, {
   3.5943915679529037`*^9, 3.594391581944707*^9}, {3.5943922022342296`*^9, 
   3.5943922023372326`*^9}, 3.5943922543692155`*^9, {3.594395928592393*^9, 
   3.5943959949831467`*^9}, {3.594396148358459*^9, 3.594396148592822*^9}, {
   3.5943971498604045`*^9, 3.59439715009478*^9}, 3.5943975671330905`*^9, {
   3.5944243221636496`*^9, 3.594424412741949*^9}, {3.594430349309186*^9, 
   3.594430351637313*^9}, {3.5944304109030538`*^9, 3.5944304109968038`*^9}, {
   3.5944311669670315`*^9, 3.5944311941702137`*^9}, {3.5944312353421693`*^9, 
   3.594431236576543*^9}, {3.5944312952485356`*^9, 3.5944312978579164`*^9}, 
   3.594431343201754*^9, {3.594431392873727*^9, 3.594431398201873*^9}, 
   3.5944373809642773`*^9, {3.594437517605177*^9, 3.5944375184332933`*^9}, {
   3.5944376002459636`*^9, 3.594437605433461*^9}, {3.594437714011798*^9, 
   3.594437745699361*^9}, {3.59443817818458*^9, 3.5944381789345818`*^9}, {
   3.594438732795059*^9, 3.594438745076318*^9}, {3.594439185342802*^9, 
   3.5944392019365826`*^9}, 3.59443924178043*^9, {3.594439316046178*^9, 
   3.594439317280572*^9}, 3.594441337374674*^9, 3.595336938829552*^9, {
   3.595339732451311*^9, 3.5953397325294037`*^9}, {3.595339849279646*^9, 
   3.5953398499202614`*^9}, {3.595448146007573*^9, 3.595448146118575*^9}, {
   3.595449405498838*^9, 3.5954494061238422`*^9}, {3.5955459474529943`*^9, 
   3.595545980355884*^9}, {3.5955486721580243`*^9, 3.5955486729549017`*^9}, {
   3.5955923490539923`*^9, 3.5955923491633797`*^9}, {3.5955987223397255`*^9, 
   3.595598778590947*^9}, {3.595599887373446*^9, 3.595599912935907*^9}, 
   3.595605886796341*^9, {3.5956360956242065`*^9, 3.5956360956554546`*^9}, {
   3.595638447846403*^9, 3.595638449752658*^9}, {3.5956388605109777`*^9, 
   3.595638860675991*^9}, {3.5956810971156545`*^9, 3.5956811002563047`*^9}, {
   3.596290863118795*^9, 3.596290865040676*^9}, {3.5963127606315517`*^9, 
   3.5963127739513144`*^9}, {3.596313042378706*^9, 3.5963130433897657`*^9}, {
   3.596422741141423*^9, 3.5964227426875153`*^9}, {3.5964229508764505`*^9, 
   3.596422952483526*^9}, {3.596423094835685*^9, 3.5964230977028427`*^9}, {
   3.5964234826908937`*^9, 3.5964234877221785`*^9}, {3.596455154399045*^9, 
   3.596455166805317*^9}, {3.5990974842248383`*^9, 3.599097484608864*^9}, {
   3.599097905640993*^9, 3.599097909633203*^9}, 3.5991453628789625`*^9, 
   3.5991454675109735`*^9, {3.599176805290516*^9, 3.5991768056165333`*^9}, {
   3.5991768596286297`*^9, 3.5991768626647987`*^9}, {3.599178957477436*^9, 
   3.599178958930561*^9}, {3.599260729603588*^9, 3.599260730445636*^9}, {
   3.599261604209673*^9, 3.599261605300737*^9}, {3.599261987067598*^9, 
   3.5992619878536396`*^9}, {3.599266740866027*^9, 3.599266741980072*^9}, 
   3.599273492091628*^9, 3.5993156984896398`*^9, 3.5993159207463703`*^9, 
   3.600568977153548*^9}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"DumpSave", "[", 
    RowBox[{"\"\<HumanWalker3D - 2.mx\>\"", ",", " ", "Z"}], "]"}], ";"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.59644442436006*^9, 3.596444454188244*^9}, {
  3.5964777612567873`*^9, 3.5964777634959154`*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"<<", "\"\<HumanWalker3D - 2.mx\>\""}], ";"}], "*)"}]], "Input",
 CellChangeTimes->{{3.5964551373052588`*^9, 3.596455139727152*^9}, {
  3.599145766860094*^9, 3.599145768356184*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"scale", " ", "=", " ", 
    RowBox[{"2", " ", "torso"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"idx", " ", "=", " ", "12"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"q0", " ", "=", " ", 
   RowBox[{
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Z", "\[LeftDoubleBracket]", 
        RowBox[{"idx", ",", " ", "1", ",", 
         RowBox[{";;", "NLink`Private`nq"}]}], "\[RightDoubleBracket]"}], 
       "}"}], ",", " ", 
      RowBox[{
       RowBox[{"dx0", "\[LeftDoubleBracket]", 
        RowBox[{";;", "NLink`Private`nq"}], "\[RightDoubleBracket]"}], 
       "\[Transpose]"}]}], "]"}], "\[Transpose]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dq0", " ", "=", " ", 
   RowBox[{
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Z", "\[LeftDoubleBracket]", 
        RowBox[{"idx", ",", " ", "1", ",", 
         RowBox[{
          RowBox[{"NLink`Private`nq", "+", "1"}], ";;", 
          RowBox[{"-", "2"}]}]}], "\[RightDoubleBracket]"}], "}"}], ",", " ", 
      RowBox[{
       RowBox[{"dx0", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{"NLink`Private`nq", "+", "1"}], ";;"}], 
        "\[RightDoubleBracket]"}], "\[Transpose]"}]}], "]"}], 
    "\[Transpose]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"t0", " ", "=", " ", 
    RowBox[{"Z", "\[LeftDoubleBracket]", 
     RowBox[{"idx", ",", " ", "1", ",", 
      RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"hw", " ", "=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"q", ",", "s"}], "}"}], ",", 
      RowBox[{"q", "/.", " ", 
       RowBox[{"First", "@", 
        RowBox[{"NDSolve", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"q", "''"}], "[", "s", "]"}], " ", "\[Equal]", " ", 
             RowBox[{"fcn", "[", 
              RowBox[{"s", ",", " ", 
               RowBox[{"q", "[", "s", "]"}], ",", " ", 
               RowBox[{
                RowBox[{"q", "'"}], "[", "s", "]"}]}], "]"}]}], ",", " ", 
            RowBox[{
             RowBox[{"q", "[", "0", "]"}], " ", "\[Equal]", " ", "q0"}], ",", 
            " ", 
            RowBox[{
             RowBox[{
              RowBox[{"q", "'"}], "[", "0", "]"}], " ", "\[Equal]", " ", 
             "dq0"}]}], "}"}], ",", " ", "q", ",", " ", 
          RowBox[{"{", 
           RowBox[{"s", ",", " ", "0", ",", " ", "t0"}], "}"}]}], "]"}]}]}]}],
      "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Animate", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"NLink`Private`DrawFigure2D", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"hw", "[", "s", "]"}], "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}], ",", " ", 
      "poi", ",", " ", 
      RowBox[{"VertexColors", "\[Rule]", " ", "colors"}], ",", " ", 
      RowBox[{"PlotRange", "\[Rule]", 
       RowBox[{"scale", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", " ", "1"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "}"}]}]}]}], "]"}], 
    "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{"s", ",", " ", "0", ",", " ", "t0"}], "}"}], ",", " ", 
   RowBox[{"AnimationRepetitions", "\[Rule]", "1"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.5936502597032385`*^9, 3.593650354734676*^9}, {
   3.59365040942227*^9, 3.5936504231879187`*^9}, {3.5936504983911934`*^9, 
   3.593650607016403*^9}, 3.593650648813361*^9, {3.5937101704561152`*^9, 
   3.5937102031124287`*^9}, 3.593710304690752*^9, {3.5937103648158674`*^9, 
   3.593710366003374*^9}, 3.5937104180347238`*^9, 3.593711864646927*^9, {
   3.5937191201454916`*^9, 3.593719213036293*^9}, {3.5937193510834427`*^9, 
   3.5937194818649445`*^9}, {3.593719527005662*^9, 3.593719560552606*^9}, {
   3.593719606365192*^9, 3.593719662849677*^9}, {3.593738897217071*^9, 
   3.5937389031702085`*^9}, {3.5937412840186253`*^9, 3.593741310346793*^9}, {
   3.5937417821602116`*^9, 3.59374178398834*^9}, {3.5937420200356755`*^9, 
   3.593742022270053*^9}, {3.59374615994635*^9, 3.593746160399488*^9}, {
   3.5937462717434444`*^9, 3.5937463073685102`*^9}, {3.594081143804101*^9, 
   3.5940811469562807`*^9}, {3.59408119628611*^9, 3.5940812025594697`*^9}, {
   3.594081247477041*^9, 3.5940813011371107`*^9}, {3.5940825829768724`*^9, 
   3.5940826380238523`*^9}, {3.5940827154615197`*^9, 3.594082716024009*^9}, {
   3.594085167651691*^9, 3.5940851676829405`*^9}, {3.5940852178080378`*^9, 
   3.594085227245557*^9}, 3.594085305792586*^9, 3.5940854419803534`*^9, {
   3.594085509636735*^9, 3.5940855931212735`*^9}, {3.594146306756657*^9, 
   3.5941463171004314`*^9}, {3.594172814071966*^9, 3.594172814431339*^9}, 
   3.594173106431914*^9, 3.5944245930704284`*^9, {3.594440609873255*^9, 
   3.594440652123347*^9}, {3.5944410452022314`*^9, 3.594441102046089*^9}, {
   3.595337058804098*^9, 3.595337114382332*^9}, {3.5953372458825893`*^9, 
   3.5953372461013427`*^9}, {3.59533729047643*^9, 3.5953372991326942`*^9}, {
   3.595546125793668*^9, 3.5955461346686845`*^9}, {3.595546851591962*^9, 
   3.595546862170109*^9}, {3.5955468928732934`*^9, 3.595546914560837*^9}, {
   3.5955964339736814`*^9, 3.5955964398120155`*^9}, {3.59563186201683*^9, 
   3.5956318632043333`*^9}, {3.5956360558741283`*^9, 3.595636060436634*^9}, {
   3.595636121093004*^9, 3.5956361617805815`*^9}, {3.595638184799013*^9, 
   3.595638185517769*^9}, {3.5956382787992105`*^9, 3.595638280658577*^9}, {
   3.595681158256401*^9, 3.5956811782876887`*^9}, {3.5963014097097607`*^9, 
   3.5963014598660994`*^9}, {3.5963015139130697`*^9, 
   3.5963015588194113`*^9}, {3.596301812491787*^9, 3.596301815726165*^9}, {
   3.5964233005554624`*^9, 3.5964233187265177`*^9}, {3.5964233772418537`*^9, 
   3.596423377499869*^9}, {3.596444654141754*^9, 3.5964446541730056`*^9}, {
   3.596444718032507*^9, 3.596444718626259*^9}, {3.5990975983113728`*^9, 
   3.599097615375353*^9}, {3.599148742177657*^9, 3.5991487422401705`*^9}, {
   3.599149597907488*^9, 3.5991495993935566`*^9}, {3.599160932789585*^9, 
   3.599160946827389*^9}, {3.599315868952405*^9, 3.5993158695074387`*^9}, {
   3.6005698175845766`*^9, 3.6005698287362156`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Print", "[", "\"\<q[0]\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"q0", " ", "=", " ", 
   RowBox[{
    RowBox[{"hw", "[", "0", "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", " ", "1"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"g2", " ", "=", " ", 
   RowBox[{
    RowBox[{"NLink`Private`DrawFigure2D", "[", 
     RowBox[{"q0", ",", " ", "poi", ",", " ", 
      RowBox[{"VertexColors", "\[Rule]", " ", "colors"}], ",", " ", 
      RowBox[{"PlotRange", "\[Rule]", 
       RowBox[{"scale", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", " ", "1"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "}"}]}]}]}], "]"}], 
    "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", "\"\<q[t0]\>\"", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"q0", " ", "=", " ", 
   RowBox[{
    RowBox[{"hw", "[", "t0", "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", " ", "1"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"g6", " ", "=", " ", 
   RowBox[{
    RowBox[{"NLink`Private`DrawFigure2D", "[", 
     RowBox[{"q0", ",", " ", "poi", ",", " ", 
      RowBox[{"VertexColors", "\[Rule]", " ", "colors"}], ",", " ", 
      RowBox[{"PlotRange", "\[Rule]", 
       RowBox[{"scale", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", " ", "1"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "}"}]}]}]}], "]"}], 
    "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", "\"\<q[0] & q[t0]\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Show", "[", 
  RowBox[{"g2", ",", "g6", ",", " ", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.595638353611842*^9, 3.5956383586743526`*^9}, {
   3.5956799332445717`*^9, 3.59567994143209*^9}, 3.595680031104138*^9, {
   3.595680522151986*^9, 3.5956805986989965`*^9}, {3.595680727418003*^9, 
   3.5956807384180193`*^9}, {3.595680920496501*^9, 3.5956810023404117`*^9}, {
   3.596301923679496*^9, 3.596302023335943*^9}, {3.5963020582891345`*^9, 
   3.596302068414152*^9}, {3.596423354112529*^9, 3.5964233608069124`*^9}, {
   3.5964233943028307`*^9, 3.5964233982460527`*^9}, {3.5990976929947977`*^9, 
   3.5990977721973333`*^9}, {3.599178895789816*^9, 3.599178896789834*^9}, {
   3.599261277025936*^9, 3.5992612794430723`*^9}}],

Cell[BoxData[
 RowBox[{"Animate", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"NLink`Private`DrawFigure2D", "[", 
     RowBox[{
      RowBox[{"Z", "\[LeftDoubleBracket]", 
       RowBox[{"i", ",", "1"}], "\[RightDoubleBracket]"}], ",", " ", "poi", 
      ",", " ", 
      RowBox[{"VertexColors", "\[Rule]", " ", "colors"}], ",", " ", 
      RowBox[{"PlotRange", "\[Rule]", 
       RowBox[{"scale", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", " ", "1"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "}"}]}]}]}], "]"}], 
    "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",", 
   RowBox[{"{", 
    RowBox[{"i", ",", " ", 
     RowBox[{"Range", "@", 
      RowBox[{"Length", "@", "Z"}]}]}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.593629141293112*^9, 3.59362915368375*^9}, {
   3.593629236574534*^9, 3.5936292694964714`*^9}, {3.5936293309965944`*^9, 
   3.593629369387295*^9}, {3.5936295205594635`*^9, 3.5936297229661107`*^9}, {
   3.593629768044335*^9, 3.5936297814037256`*^9}, {3.5936315800166283`*^9, 
   3.5936315822353725`*^9}, {3.5936316296261024`*^9, 
   3.5936316327042313`*^9}, {3.5936475918698835`*^9, 
   3.5936476782606907`*^9}, {3.5936477657608614`*^9, 3.593647780260877*^9}, {
   3.593647823479714*^9, 3.5936478306203527`*^9}, {3.5936478685422993`*^9, 
   3.59364795591747*^9}, {3.5936480667770615`*^9, 3.593648069370819*^9}, {
   3.5936481948398113`*^9, 3.5936482243242636`*^9}, {3.593648388730816*^9, 
   3.593648469871599*^9}, {3.5936485151060762`*^9, 3.5936485176373177`*^9}, {
   3.5936486107937536`*^9, 3.5936486877939167`*^9}, {3.593648956950679*^9, 
   3.5936489940132513`*^9}, 3.593649145919797*^9, {3.5936492491387486`*^9, 
   3.593649253795024*^9}, {3.593649293904461*^9, 3.5936492941075864`*^9}, {
   3.5936493481389427`*^9, 3.593649351560824*^9}, {3.5936494112796917`*^9, 
   3.5936494262953444`*^9}, {3.593649462076665*^9, 3.593649471342308*^9}, {
   3.5936495775925183`*^9, 3.593649583061277*^9}, {3.5936496361082573`*^9, 
   3.5936496474207907`*^9}, {3.5936497471397247`*^9, 
   3.5936497843585496`*^9}, {3.59364981974924*^9, 3.593649851249304*^9}, {
   3.593649926890087*^9, 3.593649999515216*^9}, {3.593650133593603*^9, 
   3.5936501858749547`*^9}, {3.5936502284688206`*^9, 3.593650236015681*^9}, {
   3.593710217237457*^9, 3.5937102726125636`*^9}, 3.593725119424674*^9, {
   3.594053869114047*^9, 3.59405387095415*^9}, {3.5940539641384897`*^9, 
   3.594054029480228*^9}, {3.5940794610867558`*^9, 3.5940795085884714`*^9}, {
   3.594085911632182*^9, 3.5940859210384517`*^9}, {3.59414571258362*^9, 
   3.5941457163180094`*^9}, {3.5944245676641283`*^9, 
   3.5944245808516545`*^9}, {3.594428710790354*^9, 3.594428729868518*^9}, {
   3.5953400362956247`*^9, 3.5953400561081643`*^9}, {3.59534009624006*^9, 
   3.5953401045994525`*^9}, {3.59554675073239*^9, 3.5955467568261538`*^9}, {
   3.595546885701413*^9, 3.595546887935783*^9}, {3.595546924185853*^9, 
   3.5955469304671173`*^9}, {3.595605952733533*^9, 3.595605957639789*^9}, {
   3.5956360810773005`*^9, 3.595636084608556*^9}, {3.5956811352094817`*^9, 
   3.595681136850108*^9}, {3.5963021250548935`*^9, 3.5963021688206043`*^9}, {
   3.5964234219264097`*^9, 3.5964234257446313`*^9}, {3.5991619049232254`*^9, 
   3.5991619294646306`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"x", "=", 
    RowBox[{"Interpolation", "[", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"s", "/", 
           RowBox[{
            RowBox[{"hw", "[", "\"\<Domain\>\"", "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "}"}], ",", 
         RowBox[{
          RowBox[{"hw", "[", "s", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"s", ",", 
         RowBox[{
          RowBox[{"hw", "[", "\"\<Coordinates\>\"", "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"lengths", "=", 
    RowBox[{"{", 
     RowBox[{"leg", ",", 
      RowBox[{"-", "leg"}], ",", "torso", ",", 
      RowBox[{"-", "arm"}], ",", 
      RowBox[{"-", "arm"}]}], "}"}]}], ";"}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"q2p", "[", "q_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "p", "}"}], ",", 
      RowBox[{
       RowBox[{"p", "=", 
        RowBox[{
         RowBox[{"NLink`Private`GetPoints", "[", "q", "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"p", "=", 
        RowBox[{"p", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"p", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"A0", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ".", "q"}], ",", 
             RowBox[{"lengths", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "NLink`Private`nq"}], "}"}]}], "]"}]}]}], "]"}]}],
    ";"}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"z", "=", 
   RowBox[{
    RowBox[{"NLink`Private`GetPointsAndLines", "[", 
     RowBox[{
      RowBox[{"x", "[", "0", "]"}], ",", "poi"}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"1", ",", 
      RowBox[{"n", "+", "1"}], ",", 
      RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"z", "=", 
    RowBox[{"ArcTan", "[", 
     RowBox[{
      RowBox[{"z", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "/", 
      RowBox[{"z", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"MotionBlur", "[", 
    RowBox[{"x", ",", "q2p", ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "5"}], "}"}], ",", 
     RowBox[{"z", "&"}], ",", 
     RowBox[{"\"\<stepsize\>\"", "\[Rule]", 
      RowBox[{"1", "/", "3"}]}], ",", 
     RowBox[{"\"\<radius\>\"", "\[Rule]", 
      RowBox[{"1", "/", "28"}]}]}], "]"}], ",", 
   RowBox[{"PlotRange", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "1"}], "/", "2"}], ",", "0.6"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "1"}], ",", "1.3"}], "}"}]}], "}"}]}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.600569604315363*^9, 3.6005696343670845`*^9}, 
   3.6005696749444094`*^9, 3.6005697402491436`*^9, {3.600569775094158*^9, 
   3.600569785412734*^9}}]
},
WindowSize->{707, 760},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"9.0 for Microsoft Windows (32-bit) (January 25, 2013)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 985, 24, 132, "Input"],
Cell[1545, 46, 8363, 136, 232, "Input"],
Cell[CellGroupData[{
Cell[9933, 186, 8025, 123, 152, "Input"],
Cell[17961, 311, 744, 19, 56, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[18742, 335, 1780, 48, 132, "Input"],
Cell[20525, 385, 773, 20, 56, "Output"]
}, Open  ]],
Cell[21313, 408, 8197, 167, 632, "Input"],
Cell[29513, 577, 6668, 150, 432, "Input"],
Cell[36184, 729, 19556, 455, 1352, "Input"],
Cell[55743, 1186, 3645, 79, 272, "Input"],
Cell[59391, 1267, 12802, 266, 552, "Input"],
Cell[72196, 1535, 5650, 94, 172, "Input"],
Cell[77849, 1631, 5328, 85, 152, "Input"],
Cell[83180, 1718, 283, 7, 31, "Input"],
Cell[83466, 1727, 233, 5, 31, "Input"],
Cell[83702, 1734, 6621, 141, 372, "Input"],
Cell[90326, 1877, 2778, 69, 252, "Input"],
Cell[93107, 1948, 3380, 59, 72, "Input"],
Cell[96490, 2009, 3633, 110, 312, "Input"]
}
]
*)

(* End of internal cache information *)
