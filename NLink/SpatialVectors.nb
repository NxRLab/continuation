(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     49282,       1120]
NotebookOptionsPosition[     48350,       1084]
NotebookOutlinePosition[     48726,       1100]
CellTagsIndexPosition[     48683,       1097]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Begin Package", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}}],

Cell[BoxData[{
 RowBox[{"BeginPackage", "[", "\"\<NLink`\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.5844197483839703`*^9, {3.5844250604318256`*^9, 3.5844250721475377`*^9}, {
   3.5844251233785*^9, 3.5844251234877005`*^9}, {3.5844253988774505`*^9, 
   3.5844254390946617`*^9}, {3.5844254919948354`*^9, 3.5844254990149255`*^9}, 
   3.584425543397398*^9, {3.584425574800518*^9, 3.584425581945394*^9}, {
   3.5844256737523947`*^9, 3.5844257230957055`*^9}, {3.5844279668250203`*^9, 
   3.5844279860756264`*^9}, {3.584428374816189*^9, 3.584428378919037*^9}, {
   3.5914865865694637`*^9, 3.591486626255737*^9}, {3.5914867823906765`*^9, 
   3.5914867827646985`*^9}, {3.591486817520689*^9, 3.5914868205858636`*^9}, {
   3.591486965884186*^9, 3.5914869664642324`*^9}, {3.5915022447717495`*^9, 
   3.5915022459698176`*^9}, {3.591542902441803*^9, 3.591542929051241*^9}, {
   3.59154329988008*^9, 3.591543327692632*^9}, 3.5915439898189273`*^9, {
   3.5915443331789765`*^9, 3.5915443348977413`*^9}, {3.591544409656703*^9, 
   3.591544412687962*^9}, {3.591721260928192*^9, 3.591721326772053*^9}, {
   3.592239943509227*^9, 3.5922399820561876`*^9}, {3.5922472305833893`*^9, 
   3.592247244802156*^9}, {3.5922512353880877`*^9, 3.5922512705444045`*^9}, {
   3.5922513050913467`*^9, 3.5922514372009954`*^9}, {3.59225146788854*^9, 
   3.592251700685872*^9}, 3.592254598707162*^9, {3.5922546582385283`*^9, 
   3.5922546594416585`*^9}, {3.5922548578326693`*^9, 3.592254859379553*^9}, 
   3.592255489566574*^9, {3.5922791418954496`*^9, 3.5922791426874943`*^9}, {
   3.5922792189568634`*^9, 3.5922792372149057`*^9}, 3.5922798737793617`*^9, {
   3.593367644000187*^9, 3.593367644125187*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Spatial Vector Library", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.5916678523159876`*^9, 3.591667856467229*^9}, {3.592247237630267*^9, 
  3.592247238880283*^9}, {3.5933101246677265`*^9, 3.5933101251364794`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"rotate", " ", "the", " ", "frame", " ", "\"\<foward\>\""}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"rot3", "[", 
      RowBox[{"q_", ",", " ", "a_"}], "]"}], " ", ":=", " ", 
     RowBox[{"RotationMatrix", "[", 
      RowBox[{
       RowBox[{"-", "q"}], ",", " ", "a"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "take", " ", "3", "x3", " ", "matrices", " ", "and", " ", "make", " ", 
     "a", " ", "6", "x6", " ", "matrix"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Mat6", "[", 
     RowBox[{"M11_", ",", " ", "M12_", ",", " ", "M21_", ",", " ", "M22_"}], 
     "]"}], " ", ":=", " ", 
    RowBox[{"ArrayFlatten", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"M11", ",", " ", "M12"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"M21", ",", " ", "M22"}], "}"}]}], "}"}], 
     "]"}]}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5888576814573565`*^9, 3.5888576965042715`*^9}, {
   3.588882259980151*^9, 3.58888229287833*^9}, {3.5922491181495695`*^9, 
   3.592249124899598*^9}, {3.5922492310872936`*^9, 3.592249248462327*^9}, {
   3.5922492794311357`*^9, 3.592249453212725*^9}, {3.5922501133858905`*^9, 
   3.592250146870332*^9}, 3.592250183182903*^9, {3.5922549616453753`*^9, 
   3.5922549620360003`*^9}, {3.5922556328927836`*^9, 3.5922556466355705`*^9}, 
   3.592279896759678*^9, {3.592350215340423*^9, 3.5923502350315485`*^9}, {
   3.5923503302490015`*^9, 3.592350333387202*^9}, {3.592350713756966*^9, 
   3.5923507212063923`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"cross", " ", "products"}], ",", " ", 
    RowBox[{
    "useful", " ", "for", " ", "coordinate", " ", "transforms", " ", "of", 
     " ", "spatial", " ", "velocities", " ", "and", " ", "forces"}]}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"skew", "[", "x_", "]"}], " ", ":=", 
     RowBox[{"(", "\[NoBreak]", GridBox[{
        {"0", 
         RowBox[{"-", 
          RowBox[{
          "x", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
         RowBox[{"x", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]},
        {
         RowBox[{"x", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
         "0", 
         RowBox[{"-", 
          RowBox[{
          "x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]},
        {
         RowBox[{"-", 
          RowBox[{
          "x", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
         RowBox[{"x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
         "0"}
       }], "\[NoBreak]", ")"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mx", "[", "m_", "]"}], " ", ":=", " ", 
     RowBox[{"Mat6", "[", 
      RowBox[{
       RowBox[{"skew", "@", 
        RowBox[{"m", "\[LeftDoubleBracket]", 
         RowBox[{"1", ";;", "3"}], "\[RightDoubleBracket]"}]}], ",", " ", 
       "Z3", ",", " ", 
       RowBox[{"skew", "@", 
        RowBox[{"m", "\[LeftDoubleBracket]", 
         RowBox[{"4", ";;", "6"}], "\[RightDoubleBracket]"}]}], ",", " ", 
       RowBox[{"skew", "@", 
        RowBox[{"m", "\[LeftDoubleBracket]", 
         RowBox[{"1", ";;", "3"}], "\[RightDoubleBracket]"}]}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mxstar", "[", "m_", "]"}], " ", ":=", " ", 
     RowBox[{"-", 
      RowBox[{
       RowBox[{"mx", "[", "m", "]"}], "\[Transpose]"}]}]}], 
    ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.588847733607463*^9, 3.588847759828424*^9}, {
   3.5888477905747843`*^9, 3.588847828252576*^9}, {3.588847862884996*^9, 
   3.5888478941729517`*^9}, {3.58884798336229*^9, 3.5888480472794127`*^9}, {
   3.588848279822406*^9, 3.5888482893396187`*^9}, {3.5888484022789187`*^9, 
   3.5888484565628166`*^9}, {3.5888484919353137`*^9, 
   3.5888484962748775`*^9}, {3.5888485974837265`*^9, 
   3.5888486048706846`*^9}, {3.588848656820795*^9, 3.5888486569867973`*^9}, {
   3.5888488524644227`*^9, 3.5888489626124253`*^9}, {3.588856113551424*^9, 
   3.588856114062484*^9}, {3.5888569283999715`*^9, 3.588856962461301*^9}, {
   3.5888569952564683`*^9, 3.5888570036745567`*^9}, {3.5888570631720963`*^9, 
   3.5888570632381086`*^9}, {3.588857704035243*^9, 3.588857704446299*^9}, {
   3.588858189277627*^9, 3.588858192446048*^9}, {3.5888582809341908`*^9, 
   3.5888582946159487`*^9}, {3.5915731377032204`*^9, 3.591573140343835*^9}, 
   3.5922403990101166`*^9, 3.5922405267916145`*^9, {3.5922433610116796`*^9, 
   3.5922433641991863`*^9}, {3.592247110895647*^9, 3.5922471167862806`*^9}, {
   3.5922472124270935`*^9, 3.5922472140677214`*^9}, {3.592250936075*^9, 
   3.592251014997032*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Plucker", " ", "coordinate", " ", "transformation"}], " ", "*)"}],
   "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"transX", "[", "x_", "]"}], " ", ":=", 
     RowBox[{"Mat6", "[", 
      RowBox[{"I3", ",", " ", "Z3", ",", "  ", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"skew", "@", 
          RowBox[{
          "I3", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
        " ", "x"}], ",", " ", "I3"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"transY", "[", "y_", "]"}], " ", ":=", 
     RowBox[{"Mat6", "[", 
      RowBox[{"I3", ",", " ", "Z3", ",", "  ", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"skew", "@", 
          RowBox[{
          "I3", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}]}], 
        " ", "y"}], ",", " ", "I3"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"transZ", "[", "z_", "]"}], " ", ":=", 
     RowBox[{"Mat6", "[", 
      RowBox[{"I3", ",", " ", "Z3", ",", "  ", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"skew", "@", 
          RowBox[{
          "I3", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}]}], 
        " ", "z"}], ",", " ", "I3"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"trans", "[", "r_", "]"}], " ", ":=", 
     RowBox[{
      RowBox[{"transZ", "[", 
       RowBox[{"r", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
       "]"}], ".", 
      RowBox[{"transY", "[", 
       RowBox[{"r", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
       "]"}], ".", 
      RowBox[{"transX", "[", 
       RowBox[{"r", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
       "]"}]}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"rotX", "[", "\[CurlyPhi]_", "]"}], " ", ":=", " ", 
     RowBox[{"Mat6", "[", 
      RowBox[{
       RowBox[{"rot3", "[", 
        RowBox[{"\[CurlyPhi]", ",", " ", 
         RowBox[{
         "I3", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
        "]"}], ",", " ", "Z3", ",", " ", "Z3", ",", " ", 
       RowBox[{"rot3", "[", 
        RowBox[{"\[CurlyPhi]", ",", " ", 
         RowBox[{
         "I3", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
        "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"rotY", "[", "\[Theta]_", "]"}], " ", ":=", " ", 
     RowBox[{"Mat6", "[", 
      RowBox[{
       RowBox[{"rot3", "[", 
        RowBox[{"\[Theta]", ",", " ", 
         RowBox[{
         "I3", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
        "]"}], ",", " ", "Z3", ",", " ", "Z3", ",", " ", 
       RowBox[{"rot3", "[", 
        RowBox[{"\[Theta]", ",", " ", 
         RowBox[{
         "I3", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
        "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"rotZ", "[", "\[Psi]_", "]"}], " ", ":=", " ", 
     RowBox[{"Mat6", "[", 
      RowBox[{
       RowBox[{"rot3", "[", 
        RowBox[{"\[Psi]", ",", " ", 
         RowBox[{
         "I3", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
        "]"}], ",", " ", "Z3", ",", " ", "Z3", ",", " ", 
       RowBox[{"rot3", "[", 
        RowBox[{"\[Psi]", ",", " ", 
         RowBox[{
         "I3", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
        "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"rot", "[", "q_", "]"}], " ", ":=", " ", 
     RowBox[{
      RowBox[{"rotZ", "[", 
       RowBox[{"q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
       "]"}], ".", 
      RowBox[{"rotY", "[", 
       RowBox[{"q", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
       "]"}], ".", 
      RowBox[{"rotX", "[", 
       RowBox[{"q", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
       "]"}]}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Xba", "[", "x_", "]"}], " ", ":=", " ", 
     RowBox[{
      RowBox[{"rot", "[", 
       RowBox[{"x", "\[LeftDoubleBracket]", 
        RowBox[{"1", ";;", "3"}], "\[RightDoubleBracket]"}], "]"}], ".", 
      RowBox[{"trans", "[", 
       RowBox[{"x", "\[LeftDoubleBracket]", 
        RowBox[{"4", ";;", "6"}], "\[RightDoubleBracket]"}], "]"}]}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Xstarba", "[", "x_", "]"}], " ", ":=", " ", 
     RowBox[{
      RowBox[{"Inverse", "@", 
       RowBox[{"Xba", "[", "x", "]"}]}], "\[Transpose]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"InvXba", "[", "Xba_", "]"}], " ", ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"X", ",", " ", "R", ",", " ", "p"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"X", " ", "=", " ", "Xba"}], ";", "\[IndentingNewLine]", 
        RowBox[{"R", " ", "=", " ", 
         RowBox[{
          RowBox[{"X", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{"1", ";;", "3"}], ",", 
            RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}], 
          "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"p", " ", "=", " ", 
         RowBox[{"-", 
          RowBox[{"X", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{"4", ";;", "6"}], ",", 
            RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"X", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"1", ";;", "3"}], ",", 
           RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}], " ", "=", 
         " ", "R"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"X", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"4", ";;", "6"}], ",", 
           RowBox[{"4", ";;", "6"}]}], "\[RightDoubleBracket]"}], " ", "=", 
         " ", "R"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"X", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"4", ";;", "6"}], ",", 
           RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}], " ", "=", 
         " ", 
         RowBox[{"R", ".", "p", ".", "R"}]}], ";", "\[IndentingNewLine]", 
        "X"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"inertia", " ", "coordinate", " ", "transformation"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Io", "[", 
      RowBox[{"m_", ",", " ", "x_", ",", " ", "Ic_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "I", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"I", " ", "=", " ", 
         RowBox[{
          RowBox[{"KroneckerProduct", "[", 
           RowBox[{
            RowBox[{"(", "\[NoBreak]", GridBox[{
               {"1", "0"},
               {"0", "0"}
              }], "\[NoBreak]", ")"}], ",", " ", "Ic"}], "]"}], " ", "+", " ", 
          RowBox[{"KroneckerProduct", "[", 
           RowBox[{
            RowBox[{"(", "\[NoBreak]", GridBox[{
               {"0", "0"},
               {"0", "1"}
              }], "\[NoBreak]", ")"}], ",", " ", 
            RowBox[{"m", " ", "I3"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Xba", "[", "x", "]"}], "\[Transpose]"}], ".", "I", ".", 
         RowBox[{"Xba", "[", "x", "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}],
     ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5883680626736507`*^9, 3.5883681143362107`*^9}, {
   3.5883682419934025`*^9, 3.588368284735835*^9}, {3.588368380658026*^9, 
   3.588368423193433*^9}, {3.588368475327829*^9, 3.588368546857668*^9}, {
   3.588368595975931*^9, 3.588368596300953*^9}, {3.588369090868146*^9, 
   3.5883691136090345`*^9}, {3.588369205784746*^9, 3.5883692197225175`*^9}, {
   3.588369266813512*^9, 3.588369371765544*^9}, {3.588369407717795*^9, 
   3.5883694952092605`*^9}, {3.588369545997448*^9, 3.588369553163358*^9}, {
   3.5883696039293337`*^9, 3.588369606561659*^9}, {3.588369683777155*^9, 
   3.5883696908660717`*^9}, {3.588369774724355*^9, 3.5883698415087204`*^9}, {
   3.5883698953355613`*^9, 3.5883699325762568`*^9}, {3.5883699786548586`*^9, 
   3.5883699788058777`*^9}, {3.588370034738986*^9, 3.5883701184452534`*^9}, {
   3.5883701607107553`*^9, 3.588370163186053*^9}, {3.5883702770377665`*^9, 
   3.5883703695715156`*^9}, {3.588370402145919*^9, 3.58837040223193*^9}, {
   3.5883705166322165`*^9, 3.5883705423064837`*^9}, {3.5883705807383637`*^9, 
   3.5883706676898165`*^9}, {3.588370700046929*^9, 3.5883708000246363`*^9}, {
   3.5883708518594575`*^9, 3.5883708650221305`*^9}, {3.588370895914056*^9, 
   3.5883709294949284`*^9}, {3.5883710098921447`*^9, 3.588371015808897*^9}, {
   3.5883710855107574`*^9, 3.588371219120737*^9}, {3.5883712635052185`*^9, 
   3.5883713466527863`*^9}, {3.5883713938811073`*^9, 3.588371397482565*^9}, {
   3.588371430981823*^9, 3.5883714315389047`*^9}, {3.5883714709599037`*^9, 
   3.5883715566387973`*^9}, {3.588371625410557*^9, 3.5883716256115613`*^9}, {
   3.5883716564344997`*^9, 3.588371678999352*^9}, {3.5883718223285637`*^9, 
   3.5883718226596255`*^9}, {3.588371899312368*^9, 3.5883719346798444`*^9}, {
   3.5883721065496883`*^9, 3.5883721367865314`*^9}, {3.5883721699897523`*^9, 
   3.5883721951099434`*^9}, {3.588372236232172*^9, 3.5883722423299446`*^9}, {
   3.5883723496965914`*^9, 3.5883723707682877`*^9}, {3.5883724747953606`*^9, 
   3.5883725442066402`*^9}, {3.5883726026810713`*^9, 3.588372703934963*^9}, {
   3.588372734290309*^9, 3.588372734823393*^9}, {3.5883728288863316`*^9, 
   3.5883728292193923`*^9}, {3.5883731311981635`*^9, 
   3.5883731373089404`*^9}, {3.588373190706727*^9, 3.5883732155088954`*^9}, {
   3.5883733203762074`*^9, 3.5883734370666227`*^9}, {3.588374387376834*^9, 
   3.5883743997534094`*^9}, 3.588376127164132*^9, {3.58837619826116*^9, 
   3.588376300234121*^9}, 3.5883771643741174`*^9, {3.5885019440497904`*^9, 
   3.5885019451106215`*^9}, {3.5885022197203474`*^9, 3.588502221810779*^9}, {
   3.588847690393952*^9, 3.5888477180614815`*^9}, {3.588847917951976*^9, 
   3.588847947997794*^9}, {3.5888480928672247`*^9, 3.588848120934806*^9}, {
   3.5888570995067177`*^9, 3.588857132309902*^9}, {3.5888571683324656`*^9, 
   3.5888571854316397`*^9}, {3.588857255695913*^9, 3.588857305054199*^9}, {
   3.588857369915962*^9, 3.588857391193657*^9}, 3.5888574423079824`*^9, {
   3.588857496454846*^9, 3.5888574980750494`*^9}, {3.5888575310222588`*^9, 
   3.588857531487299*^9}, {3.5888576712890615`*^9, 3.5888576722131815`*^9}, {
   3.5888577612303767`*^9, 3.5888577612884026`*^9}, {3.5888581422372007`*^9, 
   3.588858143795399*^9}, {3.588858251476533*^9, 3.5888582615977335`*^9}, {
   3.5888583179959016`*^9, 3.588858323153573*^9}, {3.588858366309039*^9, 
   3.588858366735096*^9}, {3.588858753489617*^9, 3.5888587686955495`*^9}, {
   3.588858813643262*^9, 3.58885881821986*^9}, {3.5888827458164062`*^9, 
   3.5888827542294784`*^9}, {3.5922436151059265`*^9, 3.592243653012251*^9}, {
   3.5922436856685643`*^9, 3.5922437073561068`*^9}, {3.5922447134690824`*^9, 
   3.592244720937848*^9}, {3.5922452877983294`*^9, 3.592245311267125*^9}, {
   3.592246179893828*^9, 3.5922462054251237`*^9}, {3.592246268800248*^9, 
   3.5922462901909328`*^9}, {3.5922478370689583`*^9, 
   3.5922478446314545`*^9}, {3.59224830647611*^9, 3.5922483836012583`*^9}, {
   3.5922484549607725`*^9, 3.5922485309140472`*^9}, {3.5922497934008913`*^9, 
   3.592249951291827*^9}, {3.5922500014950495`*^9, 3.592250025573221*^9}, {
   3.5922500565264072`*^9, 3.592250059729539*^9}, {3.592250177151639*^9, 
   3.592250226854863*^9}, {3.5923505293884087`*^9, 3.592350553375779*^9}, {
   3.592787044096955*^9, 3.592787044662984*^9}, {3.602519741383647*^9, 
   3.6025197975712566`*^9}, {3.6025198334619493`*^9, 
   3.6025198475244765`*^9}, {3.6025199087589903`*^9, 3.602519951743431*^9}, {
   3.6025428688950777`*^9, 3.6025429198389854`*^9}, {3.6025429616583805`*^9, 
   3.602542962475433*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "derivatives", " ", "of", " ", "spatial", " ", "vector", " ", 
    "functions"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Quiet", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Q", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"q", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
         ",", " ", 
         RowBox[{"q", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
         ",", " ", 
         RowBox[{
         "q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"X", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
         ",", " ", 
         RowBox[{"x", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
         ",", 
         RowBox[{"x", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
         ",", " ", 
         RowBox[{"x", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], 
         ",", " ", 
         RowBox[{"x", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}], 
         ",", 
         RowBox[{
         "x", "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}]}], 
        "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"dskew", "[", "x_", "]"}], " ", ":=", " ", 
       RowBox[{"Evaluate", "@", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"skew", "[", "x", "]"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"X", "\[LeftDoubleBracket]", 
            RowBox[{"1", ";;", "3"}], "\[RightDoubleBracket]"}], "}"}]}], 
         "]"}]}]}], " ", ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"dmx", "[", "x_", "]"}], " ", ":=", 
       RowBox[{"Evaluate", "@", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"mx", "[", "X", "]"}], ",", " ", 
          RowBox[{"{", "X", "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"dmxstar", "[", "x_", "]"}], " ", ":=", 
       RowBox[{"Evaluate", "@", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"mxstar", "[", "X", "]"}], ",", " ", 
          RowBox[{"{", "X", "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"dtransX", "[", "q_", "]"}], " ", ":=", " ", 
       RowBox[{"Evaluate", "@", 
        RowBox[{"Quiet", "@", 
         RowBox[{"D", "[", 
          RowBox[{
           RowBox[{"transX", "[", "q", "]"}], ",", " ", "q"}], "]"}]}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"dtransY", "[", "q_", "]"}], " ", ":=", " ", 
       RowBox[{"Evaluate", "@", 
        RowBox[{"Quiet", "@", 
         RowBox[{"D", "[", 
          RowBox[{
           RowBox[{"transY", "[", "q", "]"}], ",", " ", "q"}], "]"}]}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"dtransZ", "[", "q_", "]"}], " ", ":=", " ", 
       RowBox[{"Evaluate", "@", 
        RowBox[{"Quiet", "@", 
         RowBox[{"D", "[", 
          RowBox[{
           RowBox[{"transZ", "[", "q", "]"}], ",", " ", "q"}], "]"}]}]}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drotX", "[", "q_", "]"}], " ", ":=", " ", 
       RowBox[{"Evaluate", "@", 
        RowBox[{"Quiet", "@", 
         RowBox[{"D", "[", 
          RowBox[{
           RowBox[{"rotX", "[", "q", "]"}], ",", " ", "q"}], "]"}]}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drotY", "[", "q_", "]"}], " ", ":=", " ", 
       RowBox[{"Evaluate", "@", 
        RowBox[{"Quiet", "@", 
         RowBox[{"D", "[", 
          RowBox[{
           RowBox[{"rotY", "[", "q", "]"}], ",", " ", "q"}], "]"}]}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drotZ", "[", "q_", "]"}], " ", ":=", " ", 
       RowBox[{"Evaluate", "@", 
        RowBox[{"Quiet", "@", 
         RowBox[{"D", "[", 
          RowBox[{
           RowBox[{"rotZ", "[", "q", "]"}], ",", " ", "q"}], "]"}]}]}]}], ";",
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"dtrans", "[", "q_", "]"}], " ", ":=", " ", 
       RowBox[{"Evaluate", "@", 
        RowBox[{"Quiet", "@", 
         RowBox[{"D", "[", 
          RowBox[{
           RowBox[{"trans", "[", "Q", "]"}], ",", " ", 
           RowBox[{"{", "Q", "}"}]}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drot", "[", "q_", "]"}], " ", ":=", " ", 
       RowBox[{"Evaluate", "@", 
        RowBox[{"Quiet", "@", 
         RowBox[{"D", "[", 
          RowBox[{
           RowBox[{"rot", "[", "Q", "]"}], ",", " ", 
           RowBox[{"{", "Q", "}"}]}], "]"}]}]}]}], ";"}], 
     "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"deskew", "[", "S_", "]"}], " ", ":=", 
     RowBox[{
      RowBox[{"1", "/", "2"}], 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"S", "\[LeftDoubleBracket]", 
          RowBox[{"3", ",", "2"}], "\[RightDoubleBracket]"}], "-", 
         RowBox[{"S", "\[LeftDoubleBracket]", 
          RowBox[{"2", ",", "3"}], "\[RightDoubleBracket]"}]}], ",", " ", 
        RowBox[{
         RowBox[{"S", "\[LeftDoubleBracket]", 
          RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], "-", 
         RowBox[{"S", "\[LeftDoubleBracket]", 
          RowBox[{"3", ",", "1"}], "\[RightDoubleBracket]"}]}], ",", " ", 
        RowBox[{
         RowBox[{"S", "\[LeftDoubleBracket]", 
          RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}], " ", "-", " ", 
         RowBox[{"S", "\[LeftDoubleBracket]", 
          RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}]}]}], "}"}]}]}], 
    ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.588856119597193*^9, 3.5888563218639174`*^9}, {
   3.588856375839778*^9, 3.5888565212541227`*^9}, {3.5888565592269487`*^9, 
   3.5888566603698173`*^9}, {3.5888568155325375`*^9, 3.588856819840067*^9}, {
   3.5888568910672235`*^9, 3.5888568921353593`*^9}, {3.5888582441266117`*^9, 
   3.5888583036660805`*^9}, {3.5888586650473804`*^9, 
   3.5888587094150157`*^9}, {3.588858853660348*^9, 3.5888588867175493`*^9}, {
   3.588860445519267*^9, 3.5888604456982927`*^9}, {3.5888632054135914`*^9, 
   3.5888632397077265`*^9}, {3.588863271513769*^9, 3.58886332418046*^9}, 
   3.588863678051839*^9, {3.5888645624216337`*^9, 3.5888646652865534`*^9}, {
   3.588865574454302*^9, 3.5888656114830074`*^9}, {3.588865641538827*^9, 
   3.58886564250395*^9}, {3.5888656738369317`*^9, 3.5888657289433107`*^9}, {
   3.5888658482374725`*^9, 3.5888658494666452`*^9}, {3.58886589503942*^9, 
   3.5888659114495044`*^9}, {3.5888659432025423`*^9, 3.588865944077654*^9}, {
   3.5888660851495867`*^9, 3.588866103434907*^9}, {3.5888670899017873`*^9, 
   3.5888670900428023`*^9}, {3.5888673144302917`*^9, 
   3.5888673507418876`*^9}, {3.5888673947495003`*^9, 
   3.5888673975578384`*^9}, {3.588867462102045*^9, 3.588867480733405*^9}, {
   3.5888675216166058`*^9, 3.5888675398219185`*^9}, {3.5888676644209394`*^9, 
   3.58886766512803*^9}, {3.5888709442590513`*^9, 3.588870945103159*^9}, {
   3.588882922349841*^9, 3.5888829259893265`*^9}, {3.588882968370694*^9, 
   3.588883071460209*^9}, {3.588883159602416*^9, 3.5888832239735904`*^9}, {
   3.588883275190121*^9, 3.5888832781174746`*^9}, {3.588883315985688*^9, 
   3.588883471061428*^9}, {3.588883633774104*^9, 3.588883661828683*^9}, {
   3.588883738896468*^9, 3.58888375161108*^9}, {3.588883781827916*^9, 
   3.58888379321638*^9}, {3.5921129816395187`*^9, 3.592112989991997*^9}, {
   3.59224027040049*^9, 3.5922402738223696`*^9}, {3.592240323431842*^9, 
   3.59224034041625*^9}, {3.5922469776922617`*^9, 3.592246988598531*^9}, {
   3.592247038676753*^9, 3.592247051083027*^9}, {3.592247127786302*^9, 
   3.5922471314581847`*^9}, {3.592247365099267*^9, 3.5922473701305265`*^9}, {
   3.592250324058178*^9, 3.5922503360269513`*^9}, {3.5922504882147493`*^9, 
   3.592250489996003*^9}, {3.592250744027749*^9, 3.592250744277749*^9}, {
   3.593310657840643*^9, 3.5933106603875227`*^9}, 3.593629126918069*^9, {
   3.6027667860386477`*^9, 3.6027668196045694`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MovePoint", "[", 
     RowBox[{"X_", ",", " ", "p_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"R", ",", " ", "fr"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"R", " ", "=", " ", 
        RowBox[{"X", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", "3"}], ",", 
          RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"fr", " ", "=", " ", 
        RowBox[{
         RowBox[{"R", "\[Transpose]"}], ".", 
         RowBox[{"X", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"4", ";;", "6"}], ",", 
           RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"fr", " ", "=", " ", 
        RowBox[{"-", 
         RowBox[{"deskew", "[", "fr", "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"R", "\[Transpose]"}], ".", "p"}], " ", "+", " ", "fr"}]}]}],
      "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"position", "[", "X_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "fr", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"fr", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"X", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{"1", ";;", "3"}], ",", 
            RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}], 
          "\[Transpose]"}], ".", 
         RowBox[{"X", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"4", ";;", "6"}], ",", 
           RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"-", 
        RowBox[{"deskew", "[", "fr", "]"}]}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetPoints", "[", "q_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"R", ",", " ", "X", ",", " ", "p", ",", " ", "pos"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"X", " ", "=", " ", 
       RowBox[{"Xip", "[", "q", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"R", " ", "=", " ", 
       RowBox[{"X", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", " ", 
         RowBox[{"1", ";;", "3"}], ",", " ", 
         RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", " ", "=", " ", 
       RowBox[{"position", " ", "/@", " ", "X"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"p", " ", "=", "  ", 
          RowBox[{
          "parent", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"p", " ", "\[NotEqual]", " ", "0"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
             "pos", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
             " ", "=", " ", 
             RowBox[{
              RowBox[{
              "pos", "\[LeftDoubleBracket]", "p", "\[RightDoubleBracket]"}], 
              "+", 
              RowBox[{
               RowBox[{
                RowBox[{
                "R", "\[LeftDoubleBracket]", "p", "\[RightDoubleBracket]"}], 
                "\[Transpose]"}], ".", 
               RowBox[{
               "pos", "\[LeftDoubleBracket]", "i", 
                "\[RightDoubleBracket]"}]}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
             "R", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], " ",
              "=", " ", 
             RowBox[{
              RowBox[{
              "R", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              ".", 
              RowBox[{
              "R", "\[LeftDoubleBracket]", "p", "\[RightDoubleBracket]"}]}]}],
             ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"i", ",", " ", "nq"}], "}"}]}], "\[IndentingNewLine]", "]"}],
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "return", " ", "last", " ", "link", " ", "of", " ", "expanded", " ", 
        "link", " ", "i"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
        "pos", "\[LeftDoubleBracket]", "map", "\[RightDoubleBracket]"}], ",", 
        " ", 
        RowBox[{
        "R", "\[LeftDoubleBracket]", "map", "\[RightDoubleBracket]"}]}], 
       "}"}]}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "compute", " ", "the", " ", "kinetic", " ", "and", " ", "potential", " ", 
     "energy"}], ",", " ", 
    RowBox[{"spatial", " ", "momentum"}], ",", " ", 
    RowBox[{"spatial", " ", "inertia"}], ",", " ", "mass", ",", " ", 
    RowBox[{
    "position", " ", "of", " ", "the", " ", "center", " ", "of", " ", 
     "mass"}], ",", " ", 
    RowBox[{
     RowBox[{
     "and", " ", "the", " ", "linear", " ", "velocity", " ", "of", " ", "the",
       " ", "center", " ", "of", " ", "mass", " ", "of", " ", "the", " ", 
      "entire", " ", "system"}], ";", " ", 
     RowBox[{
     "vector", " ", "quantities", " ", "are", " ", "in", " ", "link", " ", 
      "0", " ", 
      RowBox[{"coordinates", "."}]}]}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanicalQuantities", "[", "x_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "XL", ",", " ", "p", ",", " ", "vJ", ",", " ", "v", ",", " ", "Ic", ",",
        " ", "hc", ",", " ", "KE", ",", " ", "PE", ",", " ", "htot", ",", " ",
        "Itot", ",", " ", "m", ",", " ", "mC", ",", " ", "I", ",", " ", "com",
        ",", " ", "vcom"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"XL", " ", "=", " ", 
       RowBox[{"Xip", "[", "x", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"v", " ", "=", " ", "Zspat"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Ic", " ", "=", " ", "\[DoubleStruckCapitalI]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"hc", " ", "=", " ", "Zspat"}], ";", "\[IndentingNewLine]", 
      RowBox[{"KE", " ", "=", " ", "znq"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"p", " ", "=", " ", 
          RowBox[{
          "parent", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"vJ", " ", "=", " ", 
          RowBox[{
           RowBox[{
           "s", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], " ", 
           RowBox[{"x", "\[LeftDoubleBracket]", 
            RowBox[{"nq", "+", "i"}], "\[RightDoubleBracket]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"p", " ", "\[Equal]", " ", "0"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "only", " ", "use", " ", "relative", " ", "link", " ", 
             "velocity"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
             "v", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], " ",
              "=", " ", "vJ"}], ";"}], "\[IndentingNewLine]", ",", " ", 
           RowBox[{"(*", " ", "else", " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"add", " ", 
             RowBox[{"parent", "'"}], "s", " ", "value"}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
             "v", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], " ",
              "=", " ", 
             RowBox[{
              RowBox[{
               RowBox[{
               "XL", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
               ".", 
               RowBox[{
               "v", "\[LeftDoubleBracket]", "p", "\[RightDoubleBracket]"}]}], 
              " ", "+", " ", "vJ"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
          "hc", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], "=", 
          RowBox[{
           RowBox[{
           "Ic", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], ".", 
           RowBox[{
           "v", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
          "KE", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], "=", 
          RowBox[{
           RowBox[{"1", "/", "2"}], " ", 
           RowBox[{
            RowBox[{
            "v", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], ".", 
            RowBox[{
            "hc", "\[LeftDoubleBracket]", "i", 
             "\[RightDoubleBracket]"}]}]}]}], ";"}], ",", " ", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"i", ",", " ", "nq"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Itot", " ", "=", " ", "Z6"}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{"rotational", " ", "inertia"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"htot", " ", "=", " ", "z6"}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{"angular", " ", "and", " ", "linear", " ", "momentum"}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"p", " ", "=", " ", 
          RowBox[{
          "parent", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"p", " ", "\[NotEqual]", " ", "0"}], ",", " ", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
             "Ic", "\[LeftDoubleBracket]", "p", "\[RightDoubleBracket]"}], 
             " ", "=", " ", 
             RowBox[{
              RowBox[{
              "Ic", "\[LeftDoubleBracket]", "p", "\[RightDoubleBracket]"}], 
              " ", "+", " ", 
              RowBox[{
               RowBox[{
                RowBox[{
                "XL", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                "\[Transpose]"}], ".", 
               RowBox[{
               "Ic", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
               ".", 
               RowBox[{
               "XL", "\[LeftDoubleBracket]", "i", 
                "\[RightDoubleBracket]"}]}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
             "hc", "\[LeftDoubleBracket]", "p", "\[RightDoubleBracket]"}], 
             " ", "=", " ", 
             RowBox[{
              RowBox[{
              "hc", "\[LeftDoubleBracket]", "p", "\[RightDoubleBracket]"}], 
              " ", "+", " ", 
              RowBox[{
               RowBox[{
                RowBox[{
                "XL", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                "\[Transpose]"}], ".", 
               RowBox[{
               "hc", "\[LeftDoubleBracket]", "i", 
                "\[RightDoubleBracket]"}]}]}]}], ";"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Itot", "=", 
             RowBox[{"Itot", "+", 
              RowBox[{
               RowBox[{
                RowBox[{
                "XL", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                "\[Transpose]"}], ".", 
               RowBox[{
               "Ic", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
               ".", 
               RowBox[{
               "XL", "\[LeftDoubleBracket]", "i", 
                "\[RightDoubleBracket]"}]}]}]}], ";", 
            RowBox[{"htot", "=", 
             RowBox[{"htot", "+", 
              RowBox[{
               RowBox[{
                RowBox[{
                "XL", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                "\[Transpose]"}], ".", 
               RowBox[{
               "hc", "\[LeftDoubleBracket]", "i", 
                "\[RightDoubleBracket]"}]}]}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"i", ",", " ", "nq", ",", " ", "1", ",", " ", 
          RowBox[{"-", "1"}]}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"m", " ", "=", " ", 
       RowBox[{"Itot", "\[LeftDoubleBracket]", 
        RowBox[{"6", ",", "6"}], "\[RightDoubleBracket]"}]}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{"total", " ", "mass"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"mC", " ", "=", " ", 
       RowBox[{"Itot", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{"1", ";;", "3"}], ",", 
         RowBox[{"4", ";;", "6"}]}], "\[RightDoubleBracket]"}]}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{"skew", " ", "matrix"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"com", " ", "=", " ", 
       RowBox[{
        RowBox[{"deskew", "[", "mC", "]"}], "/", "m"}]}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{"center", " ", "of", " ", "mass"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"vcom", " ", "=", " ", 
       RowBox[{
        RowBox[{"htot", "\[LeftDoubleBracket]", 
         RowBox[{"4", ";;", "6"}], "\[RightDoubleBracket]"}], "/", "m"}]}], 
      ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{"center", " ", "of", " ", "mass", " ", "velocity"}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"I", " ", "=", " ", 
       RowBox[{
        RowBox[{"Itot", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", "3"}], ",", 
          RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}], " ", "-", 
        " ", 
        RowBox[{
         RowBox[{"mC", ".", 
          RowBox[{"mC", "\[Transpose]"}]}], "/", "m"}]}]}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{
       "rotational", " ", "inertia", " ", "about", " ", "center", " ", "of", 
        " ", "mass"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PE", " ", "=", " ", 
       RowBox[{"m", " ", 
        RowBox[{
         RowBox[{"ag", "\[LeftDoubleBracket]", 
          RowBox[{"4", ";;", "6"}], "\[RightDoubleBracket]"}], ".", 
         "com"}]}]}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{"total", " ", "potential", " ", "energy"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"KE", " ", "=", " ", 
       RowBox[{"Total", "[", "KE", "]"}]}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{"total", " ", "kinetic", " ", "energy"}], " ", "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
       "KE", ",", " ", "PE", ",", " ", "htot", ",", " ", "m", ",", " ", 
        "Itot", ",", " ", "com", ",", " ", "vcom"}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5925800798078823`*^9, 3.592580174479306*^9}, {
   3.592776312837759*^9, 3.5927763407003565`*^9}, {3.593627168155368*^9, 
   3.593627211874185*^9}, {3.593627295671241*^9, 3.5936273048587413`*^9}, {
   3.593627503609131*^9, 3.5936275164372807`*^9}, {3.593627906806323*^9, 
   3.5936279119469423`*^9}, {3.5936280474472046`*^9, 
   3.5936280476503325`*^9}, {3.5936283651040916`*^9, 3.593628365291579*^9}, {
   3.593628399494771*^9, 3.5936284167291794`*^9}, {3.593628449510495*^9, 
   3.5936286138858156`*^9}, {3.5936287337141743`*^9, 
   3.5936288710425706`*^9}, {3.5936291113242874`*^9, 3.59362912383994*^9}, {
   3.593977239640683*^9, 3.5939772400457067`*^9}, {3.5939774736290827`*^9, 
   3.5939774892599773`*^9}, {3.593977529858302*^9, 3.5939775574478827`*^9}, {
   3.5939776276829004`*^9, 3.593977630512067*^9}, {3.5939776716154203`*^9, 
   3.59397767177343*^9}, {3.593979563804775*^9, 3.5939796033810453`*^9}, {
   3.5939796708479075`*^9, 3.593979671595952*^9}, {3.593979707148986*^9, 
   3.5939797158334866`*^9}, {3.5939797723117204`*^9, 
   3.5939798003103237`*^9}, {3.5939800314975624`*^9, 
   3.5939800575030518`*^9}, {3.593980151672445*^9, 3.593980152483491*^9}, {
   3.593980226132709*^9, 3.593980264101882*^9}, {3.5939803358909893`*^9, 
   3.5939803422393584`*^9}, {3.593981852960452*^9, 3.593981873175627*^9}, {
   3.5939819771615677`*^9, 3.593981999737857*^9}, {3.593982128643239*^9, 
   3.5939822369964447`*^9}, {3.593982457029044*^9, 3.5939824621553373`*^9}, {
   3.593982518214548*^9, 3.593982554379616*^9}, {3.5939831159877806`*^9, 
   3.593983135672908*^9}, {3.5939834614415636`*^9, 3.5939834784325323`*^9}, {
   3.593983591802043*^9, 3.593983638667712*^9}, {3.593983679425042*^9, 
   3.5939836804971046`*^9}, {3.593983735234242*^9, 3.593984013060153*^9}, {
   3.593984236317938*^9, 3.593984239229104*^9}, 3.5939842884139214`*^9, {
   3.593984442982768*^9, 3.5939844636829586`*^9}, {3.593984499546014*^9, 
   3.5939844998900323`*^9}, {3.5939877505601826`*^9, 3.593987757332592*^9}, {
   3.5939882319557724`*^9, 3.5939883617431936`*^9}, {3.593988417378372*^9, 
   3.593988475678712*^9}, {3.5939885360671663`*^9, 3.5939885513260427`*^9}, {
   3.5939895256118374`*^9, 3.5939895318511953`*^9}, {3.593990437675069*^9, 
   3.5939904577952204`*^9}, {3.6027645461483793`*^9, 
   3.6027646265429845`*^9}, {3.60276466281406*^9, 3.602764713941988*^9}, {
   3.6027647647398977`*^9, 3.6027647699531965`*^9}, {3.6027648486327066`*^9, 
   3.602764936115711*^9}, {3.602764978749154*^9, 3.602765143323577*^9}, {
   3.6027652619913735`*^9, 3.6027654387924986`*^9}, 3.602765470973341*^9, {
   3.6027655070604076`*^9, 3.602765516082924*^9}, {3.6027656698287363`*^9, 
   3.602765669993738*^9}, {3.602765764259132*^9, 3.602765851653141*^9}, 
   3.6027659006269565`*^9, {3.602765971169986*^9, 3.6027660839214425`*^9}, {
   3.6027661687032967`*^9, 3.6027661808309917`*^9}, {3.602766216544037*^9, 
   3.6027662168040514`*^9}, {3.602766272494241*^9, 3.6027662937004557`*^9}, {
   3.6027663492206345`*^9, 3.6027664075679765`*^9}, {3.6027665001412773`*^9, 
   3.602766554860411*^9}, {3.6027666300297165`*^9, 3.602766655156152*^9}, {
   3.6027668632550716`*^9, 3.602766869528431*^9}, {3.6027669053754835`*^9, 
   3.602766906138528*^9}, {3.6027669379293485`*^9, 3.6027669744264383`*^9}, {
   3.6027670534099617`*^9, 3.602767055068057*^9}, {3.602767163332257*^9, 
   3.602767181319287*^9}, {3.6027672720784845`*^9, 3.6027673242804737`*^9}, {
   3.602767414992668*^9, 3.602767484546651*^9}, {3.602767527843128*^9, 
   3.6027676298989887`*^9}, {3.6027676979998755`*^9, 3.602767708151458*^9}, {
   3.602767949785294*^9, 3.602768003669379*^9}, {3.602768068927117*^9, 
   3.6027680690061207`*^9}, {3.6027684256915474`*^9, 
   3.6027684813187327`*^9}, {3.602768518439859*^9, 3.6027685211060114`*^9}, {
   3.6027688797395487`*^9, 3.6027688835337667`*^9}, 3.6027689279923124`*^9, {
   3.602769073527646*^9, 3.602769080572064*^9}, {3.602769112582883*^9, 
   3.602769115874072*^9}, {3.602769188562235*^9, 3.602769212169586*^9}, {
   3.6027692804965005`*^9, 3.6027692818885784`*^9}, 3.6027693639532776`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["End Package", "Section"],

Cell[BoxData[{
 RowBox[{"End", "[", "]"}], "\[IndentingNewLine]", 
 RowBox[{"EndPackage", "[", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.591486801989799*^9, 3.5914868026208353`*^9}}]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{524, 631},
WindowMargins->{{Automatic, 7}, {Automatic, -3}},
FrontEndVersion->"9.0 for Microsoft Windows (32-bit) (January 25, 2013)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[579, 22, 100, 1, 86, "Section"],
Cell[682, 25, 1773, 25, 52, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[2492, 55, 259, 3, 86, "Section"],
Cell[2754, 60, 1694, 39, 132, "Input",
 InitializationCell->True],
Cell[4451, 101, 3255, 73, 224, "Input",
 InitializationCell->True],
Cell[7709, 176, 12300, 265, 711, "Input",
 InitializationCell->True],
Cell[20012, 443, 8309, 183, 492, "Input",
 InitializationCell->True],
Cell[28324, 628, 19733, 442, 1652, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[48094, 1075, 30, 0, 86, "Section"],
Cell[48127, 1077, 207, 4, 52, "Input",
 InitializationCell->True]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
